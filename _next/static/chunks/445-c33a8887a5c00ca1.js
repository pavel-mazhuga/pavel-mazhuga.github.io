"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[445],{7831:function(e,t,r){r.d(t,{i:function(){return a}});var i=r(7294),n=r(9251),o=r(4942);class s{constructor(e=Math){(0,o.Z)(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),(0,o.Z)(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),(0,o.Z)(this,"p",[]),(0,o.Z)(this,"perm",[]),(0,o.Z)(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),(0,o.Z)(this,"dot",((e,t,r)=>e[0]*t+e[1]*r)),(0,o.Z)(this,"dot3",((e,t,r,i)=>e[0]*t+e[1]*r+e[2]*i)),(0,o.Z)(this,"dot4",((e,t,r,i,n)=>e[0]*t+e[1]*r+e[2]*i+e[3]*n)),(0,o.Z)(this,"noise",((e,t)=>{let r,i,n;const o=(e+t)*(.5*(Math.sqrt(3)-1)),s=Math.floor(e+o),a=Math.floor(t+o),u=(3-Math.sqrt(3))/6,m=(s+a)*u,l=e-(s-m),p=t-(a-m);let _=0,c=1;l>p&&(_=1,c=0);const h=l-_+u,d=p-c+u,f=l-1+2*u,v=p-1+2*u,x=255&s,g=255&a,y=this.perm[x+this.perm[g]]%12,b=this.perm[x+_+this.perm[g+c]]%12,w=this.perm[x+1+this.perm[g+1]]%12;let M=.5-l*l-p*p;M<0?r=0:(M*=M,r=M*M*this.dot(this.grad3[y],l,p));let S=.5-h*h-d*d;S<0?i=0:(S*=S,i=S*S*this.dot(this.grad3[b],h,d));let T=.5-f*f-v*v;return T<0?n=0:(T*=T,n=T*T*this.dot(this.grad3[w],f,v)),70*(r+i+n)})),(0,o.Z)(this,"noise3d",((e,t,r)=>{let i,n,o,s;const a=(e+t+r)*(1/3),u=Math.floor(e+a),m=Math.floor(t+a),l=Math.floor(r+a),p=1/6,_=(u+m+l)*p,c=e-(u-_),h=t-(m-_),d=r-(l-_);let f,v,x,g,y,b;c>=h?h>=d?(f=1,v=0,x=0,g=1,y=1,b=0):c>=d?(f=1,v=0,x=0,g=1,y=0,b=1):(f=0,v=0,x=1,g=1,y=0,b=1):h<d?(f=0,v=0,x=1,g=0,y=1,b=1):c<d?(f=0,v=1,x=0,g=0,y=1,b=1):(f=0,v=1,x=0,g=1,y=1,b=0);const w=c-f+p,M=h-v+p,S=d-x+p,T=c-g+2*p,D=h-y+2*p,R=d-b+2*p,E=c-1+.5,B=h-1+.5,C=d-1+.5,j=255&u,U=255&m,F=255&l,L=this.perm[j+this.perm[U+this.perm[F]]]%12,z=this.perm[j+f+this.perm[U+v+this.perm[F+x]]]%12,A=this.perm[j+g+this.perm[U+y+this.perm[F+b]]]%12,O=this.perm[j+1+this.perm[U+1+this.perm[F+1]]]%12;let P=.6-c*c-h*h-d*d;P<0?i=0:(P*=P,i=P*P*this.dot3(this.grad3[L],c,h,d));let V=.6-w*w-M*M-S*S;V<0?n=0:(V*=V,n=V*V*this.dot3(this.grad3[z],w,M,S));let I=.6-T*T-D*D-R*R;I<0?o=0:(I*=I,o=I*I*this.dot3(this.grad3[A],T,D,R));let k=.6-E*E-B*B-C*C;return k<0?s=0:(k*=k,s=k*k*this.dot3(this.grad3[O],E,B,C)),32*(i+n+o+s)})),(0,o.Z)(this,"noise4d",((e,t,r,i)=>{const n=this.grad4,o=this.simplex,s=this.perm,a=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20;let m,l,p,_,c;const h=(e+t+r+i)*a,d=Math.floor(e+h),f=Math.floor(t+h),v=Math.floor(r+h),x=Math.floor(i+h),g=(d+f+v+x)*u,y=e-(d-g),b=t-(f-g),w=r-(v-g),M=i-(x-g),S=(y>b?32:0)+(y>w?16:0)+(b>w?8:0)+(y>M?4:0)+(b>M?2:0)+(w>M?1:0);let T,D,R,E,B,C,j,U,F,L,z,A;T=o[S][0]>=3?1:0,D=o[S][1]>=3?1:0,R=o[S][2]>=3?1:0,E=o[S][3]>=3?1:0,B=o[S][0]>=2?1:0,C=o[S][1]>=2?1:0,j=o[S][2]>=2?1:0,U=o[S][3]>=2?1:0,F=o[S][0]>=1?1:0,L=o[S][1]>=1?1:0,z=o[S][2]>=1?1:0,A=o[S][3]>=1?1:0;const O=y-T+u,P=b-D+u,V=w-R+u,I=M-E+u,k=y-B+2*u,G=b-C+2*u,N=w-j+2*u,W=M-U+2*u,Y=y-F+3*u,Z=b-L+3*u,Q=w-z+3*u,H=M-A+3*u,q=y-1+4*u,K=b-1+4*u,$=w-1+4*u,J=M-1+4*u,X=255&d,ee=255&f,te=255&v,re=255&x,ie=s[X+s[ee+s[te+s[re]]]]%32,ne=s[X+T+s[ee+D+s[te+R+s[re+E]]]]%32,oe=s[X+B+s[ee+C+s[te+j+s[re+U]]]]%32,se=s[X+F+s[ee+L+s[te+z+s[re+A]]]]%32,ae=s[X+1+s[ee+1+s[te+1+s[re+1]]]]%32;let ue=.6-y*y-b*b-w*w-M*M;ue<0?m=0:(ue*=ue,m=ue*ue*this.dot4(n[ie],y,b,w,M));let me=.6-O*O-P*P-V*V-I*I;me<0?l=0:(me*=me,l=me*me*this.dot4(n[ne],O,P,V,I));let le=.6-k*k-G*G-N*N-W*W;le<0?p=0:(le*=le,p=le*le*this.dot4(n[oe],k,G,N,W));let pe=.6-Y*Y-Z*Z-Q*Q-H*H;pe<0?_=0:(pe*=pe,_=pe*pe*this.dot4(n[se],Y,Z,Q,H));let _e=.6-q*q-K*K-$*$-J*J;return _e<0?c=0:(_e*=_e,c=_e*_e*this.dot4(n[ae],q,K,$,J)),27*(m+l+p+_+c)}));for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let t=0;t<512;t++)this.perm[t]=this.p[255&t]}}const a=i.forwardRef((({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:o=.1,maxPitch:a=.1,maxRoll:u=.1,yawFrequency:m=.1,pitchFrequency:l=.1,rollFrequency:p=.1,controls:_},c)=>{const h=(0,n.Ky)((e=>e.camera)),d=(0,n.Ky)((e=>e.controls)),f=i.useRef(e),v=i.useRef(h.rotation.clone()),[x]=i.useState((()=>new s)),[g]=i.useState((()=>new s)),[y]=i.useState((()=>new s)),b=()=>{(f.current<0||f.current>1)&&(f.current=f.current<0?0:1)};return i.useImperativeHandle(c,(()=>({getIntensity:()=>f.current,setIntensity:e=>{f.current=e,b()}})),[]),i.useEffect((()=>{const e=d||(null==_?void 0:_.current),t=()=>{v.current=h.rotation.clone()};return null==e||e.addEventListener("change",t),()=>{null==e||e.removeEventListener("change",t)}}),[_,d]),(0,n.xQ)((({clock:e},i)=>{const n=Math.pow(f.current,2),s=o*n*x.noise(e.elapsedTime*m,1),_=a*n*g.noise(e.elapsedTime*l,1),c=u*n*y.noise(e.elapsedTime*p,1);h.rotation.set(v.current.x+_,v.current.y+s,v.current.z+c),t&&f.current>0&&(f.current-=r*i,b())})),null}))},6935:function(e,t,r){function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}r.d(t,{r:function(){return m}});var n=r(7294),o=r(2212),s=r(9251),a=r(5878);class u extends o.MeshStandardMaterial{constructor(e={}){super(e),this._debug={value:0},this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._u_mipmap_0={value:null},this._u_mipmap_1={value:null},this._u_mipmap_2={value:null},this._u_mipmap_3={value:null},this._u_mipmap_4={value:null},this._u_mipmap_5={value:null},this._u_mipmap_6={value:null},this._u_mipmap_7={value:null},this._u_mipmap_res_0={value:null},this._u_mipmap_res_1={value:null},this._u_mipmap_res_2={value:null},this._u_mipmap_res_3={value:null},this._u_mipmap_res_4={value:null},this._u_mipmap_res_5={value:null},this._u_mipmap_res_6={value:null},this._u_mipmap_res_7={value:null},this._textureMatrix={value:null},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.debug=this._debug,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.u_mipmap_0=this._u_mipmap_0,e.uniforms.u_mipmap_1=this._u_mipmap_1,e.uniforms.u_mipmap_2=this._u_mipmap_2,e.uniforms.u_mipmap_3=this._u_mipmap_3,e.uniforms.u_mipmap_4=this._u_mipmap_4,e.uniforms.u_mipmap_5=this._u_mipmap_5,e.uniforms.u_mipmap_6=this._u_mipmap_6,e.uniforms.u_mipmap_7=this._u_mipmap_7,e.uniforms.u_mipmap_res_0=this._u_mipmap_res_0,e.uniforms.u_mipmap_res_1=this._u_mipmap_res_1,e.uniforms.u_mipmap_res_2=this._u_mipmap_res_2,e.uniforms.u_mipmap_res_3=this._u_mipmap_res_3,e.uniforms.u_mipmap_res_4=this._u_mipmap_res_4,e.uniforms.u_mipmap_res_5=this._u_mipmap_res_5,e.uniforms.u_mipmap_res_6=this._u_mipmap_res_6,e.uniforms.u_mipmap_res_7=this._u_mipmap_res_7,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;     \n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform int debug;\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform sampler2D u_mipmap_0;\n        uniform sampler2D u_mipmap_1;\n        uniform sampler2D u_mipmap_2;\n        uniform sampler2D u_mipmap_3;\n        uniform sampler2D u_mipmap_4;\n        uniform sampler2D u_mipmap_5;\n        uniform sampler2D u_mipmap_6;\n        uniform sampler2D u_mipmap_7;\n        uniform vec2 u_mipmap_res_0;\n        uniform vec2 u_mipmap_res_1;\n        uniform vec2 u_mipmap_res_2;\n        uniform vec2 u_mipmap_res_3;\n        uniform vec2 u_mipmap_res_4;\n        uniform vec2 u_mipmap_res_5;\n        uniform vec2 u_mipmap_res_6;\n        uniform vec2 u_mipmap_res_7;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;  \n        \n        // from http://www.java-gaming.org/index.php?topic=35123.0\n        vec4 cubic( float v ) {\n          vec4 n = vec4( 1.0, 2.0, 3.0, 4.0 ) - v;\n          vec4 s = n * n * n;\n          float x = s.x;\n          float y = s.y - 4.0 * s.x;\n          float z = s.z - 4.0 * s.y + 6.0 * s.x;\n          float w = 6.0 - x - y - z;\n          return vec4( x, y, z, w ) * ( 1.0 / 6.0 );\n        }\n        \n        vec4 textureBicubic( sampler2D sampler, vec2 texCoords, vec2 texSize ) {\n          vec2 invTexSize = 1.0 / texSize;\n          texCoords = texCoords * texSize - 0.5;\n          vec2 fxy = fract( texCoords );\n          texCoords -= fxy;\n\n          vec4 xcubic = cubic( fxy.x );\n          vec4 ycubic = cubic( fxy.y );\n          vec4 c = texCoords.xxyy + vec2 ( - 0.5, + 1.5 ).xyxy;\n          vec4 s = vec4( xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw );\n\n          vec4 offset = c + vec4( xcubic.yw, ycubic.yw ) / s;\n          offset *= invTexSize.xxyy;\n        \n          vec4 sample0 = texture2D( sampler, offset.xz);\n          vec4 sample1 = texture2D( sampler, offset.yz);\n          vec4 sample2 = texture2D( sampler, offset.xw);\n          vec4 sample3 = texture2D( sampler, offset.yw);\n        \n          float sx = s.x / ( s.x + s.y );\n          float sy = s.z / ( s.z + s.w );\n\n          return mix(\n            mix(\n              sample3,\n              sample2,\n              sx\n            ),\n            mix(\n              sample1,\n              sample0,\n              sx\n            ),\n            sy\n          );\n        }\n\n\n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n    \n      float depthFactor = 1.0;\n      float distortionFactor = 0.0;\n      vec3 my_normal = vec3(0.0);\n      float reflectorRoughnessFactor = roughness;\n      vec3 coord = my_vUv.xyz / my_vUv.w;\n\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      #ifdef USE_NORMALMAP\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b ,  normalColor.g * 2.0 - 1.0 ) );\n      #endif\n\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n\n      vec2 proj_vUv = coord.xy + coord.z * my_normal.xz * 0.01;\n      proj_vUv.x += distortionFactor;\n      proj_vUv.y += distortionFactor;\n      \n      float lod = 1.0 - min(1.0, mixBlur * reflectorRoughnessFactor);\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2D(tDepth, proj_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor + depthToBlurRatioBias));\n      #endif\n\n      vec4 baseColor = texture2D(tDiffuse, proj_vUv);\n      vec4 mixedColor;\n\n      float _lod = (1.0 - pow(1.0 - lod, 4.0)) * 8.0;\n      if (_lod < 1.) {\n        vec4 one = textureBicubic(u_mipmap_7, proj_vUv, u_mipmap_res_7);\n        vec4 two = textureBicubic(u_mipmap_6, proj_vUv, u_mipmap_res_6);\n        mixedColor = mix(one, two, _lod);\n      } else if (_lod < 2.) {\n        vec4 one = textureBicubic(u_mipmap_6, proj_vUv, u_mipmap_res_6);\n        vec4 two = textureBicubic(u_mipmap_5, proj_vUv, u_mipmap_res_5);\n        mixedColor = mix(one, two, _lod - 1.0);\n      } else if (_lod < 3.) {\n        vec4 one = textureBicubic(u_mipmap_5, proj_vUv, u_mipmap_res_5);\n        vec4 two = textureBicubic(u_mipmap_4, proj_vUv, u_mipmap_res_4);\n        mixedColor = mix(one, two, _lod - 2.0);\n      } else if (_lod < 4.) {\n        vec4 one = textureBicubic(u_mipmap_4, proj_vUv, u_mipmap_res_4);\n        vec4 two = textureBicubic(u_mipmap_3, proj_vUv, u_mipmap_res_3);\n        mixedColor = mix(one, two, _lod - 3.0);\n      } else if (_lod < 5.) {\n        vec4 one = textureBicubic(u_mipmap_3, proj_vUv, u_mipmap_res_3);\n        vec4 two = textureBicubic(u_mipmap_2, proj_vUv, u_mipmap_res_2);\n        mixedColor = mix(one, two, _lod - 4.0);\n      } else if (_lod < 6.) {\n        vec4 one = textureBicubic(u_mipmap_2, proj_vUv, u_mipmap_res_2);\n        vec4 two = textureBicubic(u_mipmap_1, proj_vUv, u_mipmap_res_1);\n        mixedColor = mix(one, two, _lod - 5.0);\n      } else if (_lod < 7.) {\n        vec4 one = textureBicubic(u_mipmap_1, proj_vUv, u_mipmap_res_1);\n        vec4 two = textureBicubic(u_mipmap_0, proj_vUv, u_mipmap_res_0);\n        mixedColor = mix(one, two, _lod - 6.0);\n      } else {\n        vec4 one = textureBicubic(u_mipmap_0, proj_vUv, u_mipmap_res_0);\n        mixedColor = mix(one, baseColor, _lod - 7.0);\n      }\n\n      mixedColor.rgb *= depthFactor;\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + mixedColor.rgb * mixStrength);     \n      diffuseColor = sRGBToLinear(diffuseColor);\n\n      if (debug == 1) {\n        diffuseColor = sRGBToLinear(vec4(vec3(depthFactor), 1.0));\n      }\n      if (debug == 2) {\n        diffuseColor = sRGBToLinear(texture2D(tDiffuse, proj_vUv));\n      }\n      if (debug == 3) {\n        diffuseColor = sRGBToLinear(texture2D(distortionMap, vUv));\n      }\n      if (debug == 4) {\n        diffuseColor = sRGBToLinear(vec4(vec3(lod), 1.0));\n      }\n      ")}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get u_mipmap_0(){return this._u_mipmap_0.value}set u_mipmap_0(e){this._u_mipmap_0.value=e}get u_mipmap_1(){return this._u_mipmap_1.value}set u_mipmap_1(e){this._u_mipmap_1.value=e}get u_mipmap_2(){return this._u_mipmap_2.value}set u_mipmap_2(e){this._u_mipmap_2.value=e}get u_mipmap_3(){return this._u_mipmap_3.value}set u_mipmap_3(e){this._u_mipmap_3.value=e}get u_mipmap_4(){return this._u_mipmap_4.value}set u_mipmap_4(e){this._u_mipmap_4.value=e}get u_mipmap_5(){return this._u_mipmap_5.value}set u_mipmap_5(e){this._u_mipmap_5.value=e}get u_mipmap_6(){return this._u_mipmap_6.value}set u_mipmap_6(e){this._u_mipmap_6.value=e}get u_mipmap_7(){return this._u_mipmap_7.value}set u_mipmap_7(e){this._u_mipmap_7.value=e}get u_mipmap_res_0(){return this._u_mipmap_res_0.value}set u_mipmap_res_0(e){this._u_mipmap_res_0.value=e}get u_mipmap_res_1(){return this._u_mipmap_res_1.value}set u_mipmap_res_1(e){this._u_mipmap_res_1.value=e}get u_mipmap_res_2(){return this._u_mipmap_res_2.value}set u_mipmap_res_2(e){this._u_mipmap_res_2.value=e}get u_mipmap_res_3(){return this._u_mipmap_res_3.value}set u_mipmap_res_3(e){this._u_mipmap_res_3.value=e}get u_mipmap_res_4(){return this._u_mipmap_res_4.value}set u_mipmap_res_4(e){this._u_mipmap_res_4.value=e}get u_mipmap_res_5(){return this._u_mipmap_res_5.value}set u_mipmap_res_5(e){this._u_mipmap_res_5.value=e}get u_mipmap_res_6(){return this._u_mipmap_res_6.value}set u_mipmap_res_6(e){this._u_mipmap_res_6.value=e}get u_mipmap_res_7(){return this._u_mipmap_res_7.value}set u_mipmap_res_7(e){this._u_mipmap_res_7.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get debug(){return this._debug.value}set debug(e){this._debug.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}}(0,s.l7)({MeshReflectorMaterial:u});const m=n.forwardRef((({mixBlur:e=0,mixStrength:t=.5,resolution:r=256,args:u=[1,1],minDepthThreshold:m=.9,maxDepthThreshold:l=1,depthScale:p=0,depthToBlurRatioBias:_=.25,mirror:c,children:h,debug:d=0,distortion:f=1,distortionMap:v,...x},g)=>{const y=(0,s.Ky)((({gl:e})=>e)),b=(0,s.Ky)((({camera:e})=>e)),w=(0,s.Ky)((({scene:e})=>e)),M=n.useRef(null),[S]=n.useState((()=>new o.Plane)),[T]=n.useState((()=>new o.Vector3)),[D]=n.useState((()=>new o.Vector3)),[R]=n.useState((()=>new o.Vector3)),[E]=n.useState((()=>new o.Matrix4)),[B]=n.useState((()=>new o.Vector3(0,0,-1))),[C]=n.useState((()=>new o.Vector4)),[j]=n.useState((()=>new o.Vector3)),[U]=n.useState((()=>new o.Vector3)),[F]=n.useState((()=>new o.Vector4)),[L]=n.useState((()=>new o.Matrix4)),[z]=n.useState((()=>new o.PerspectiveCamera)),[A]=n.useState((()=>{const e=[],t={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBFormat,encoding:y.outputEncoding};for(let i=0;i<8;i++){const n=Math.max(8,Math.round(r/Math.pow(2,i))),s=new o.WebGLRenderTarget(n,n,t);s.texture.generateMipmaps=!1,e.push(s)}return e})),O=n.useCallback((()=>{if(D.setFromMatrixPosition(M.current.matrixWorld),R.setFromMatrixPosition(b.matrixWorld),E.extractRotation(M.current.matrixWorld),T.set(0,0,1),T.applyMatrix4(E),j.subVectors(D,R),j.dot(T)>0)return;j.reflect(T).negate(),j.add(D),E.extractRotation(b.matrixWorld),B.set(0,0,-1),B.applyMatrix4(E),B.add(R),U.subVectors(D,B),U.reflect(T).negate(),U.add(D),z.position.copy(j),z.up.set(0,1,0),z.up.applyMatrix4(E),z.up.reflect(T),z.lookAt(U),z.far=b.far,z.updateMatrixWorld(),z.projectionMatrix.copy(b.projectionMatrix),L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(z.projectionMatrix),L.multiply(z.matrixWorldInverse),L.multiply(M.current.matrixWorld),S.setFromNormalAndCoplanarPoint(T,D),S.applyMatrix4(z.matrixWorldInverse),C.set(S.normal.x,S.normal.y,S.normal.z,S.constant);const e=z.projectionMatrix;F.x=(Math.sign(C.x)+e.elements[8])/e.elements[0],F.y=(Math.sign(C.y)+e.elements[9])/e.elements[5],F.z=-1,F.w=(1+e.elements[10])/e.elements[14],C.multiplyScalar(2/C.dot(F)),e.elements[2]=C.x,e.elements[6]=C.y,e.elements[10]=C.z+1,e.elements[14]=C.w}),[b.far,b.matrixWorld,b.projectionMatrix,R,C,B,T,F,S,D,E,U,L,j,z]),[P,V]=n.useMemo((()=>{const i={minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBFormat,encoding:y.outputEncoding},n=new o.WebGLRenderTarget(r,r,i);p>0&&(n.depthBuffer=!0,n.depthTexture=new o.DepthTexture(r,r),n.depthTexture.format=o.DepthFormat,n.depthTexture.type=o.UnsignedShortType);const s=A.reduce(((e,t,r)=>(e[`u_mipmap_${r}`]=t.texture,e[`u_mipmap_res_${r}`]=new o.Vector2(t.width,t.height),e)),{});return[n,{mirror:c,textureMatrix:L,mixBlur:e,tDiffuse:n.texture,tDepth:n.depthTexture,mixStrength:t,minDepthThreshold:m,maxDepthThreshold:l,depthScale:p,depthToBlurRatioBias:_,debug:d,distortion:f,distortionMap:v,"defines-USE_DEPTH":p>0?"":void 0,"defines-USE_DISTORTION":v?"":void 0,...s}]}),[y,L,r,c,e,t,m,l,p,_,d,f,v,A]);return(0,s.xQ)((()=>{if(null==M||!M.current)return;M.current.visible=!1;const t=y.xr.enabled,r=y.shadowMap.autoUpdate;O(),y.xr.enabled=!1,y.shadowMap.autoUpdate=!1,y.setRenderTarget(P),y.state.buffers.depth.setMask(!0),y.autoClear||y.clear(),y.render(w,z),0!==e&&A.forEach((e=>{y.setRenderTarget(e),y.state.buffers.depth.setMask(!0),y.render(w,z)})),y.xr.enabled=t,y.shadowMap.autoUpdate=r,M.current.visible=!0,y.setRenderTarget(null)})),n.createElement("mesh",i({ref:(0,a.Z)([M,g])},x),n.createElement("planeBufferGeometry",{args:u}),h?h("meshReflectorMaterial",V):n.createElement("meshReflectorMaterial",V))}))},5769:function(e,t,r){r.d(t,{m:function(){return a}});var i=r(2212),n=r(9251),o=r(7294);const s=e=>e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e;function a(e){const t=(0,n.Ky)((e=>e.gl)),r=(0,n.U2)(i.TextureLoader,s(e)?Object.values(e):e);if((0,o.useEffect)((()=>{(Array.isArray(r)?r:[r]).forEach(t.initTexture)}),[t,r]),s(e)){const t=Object.keys(e),i={};return t.forEach((e=>Object.assign(i,{[e]:r[t.indexOf(e)]}))),i}return r}a.preload=e=>n.U2.preload(i.TextureLoader,e),a.clear=e=>n.U2.clear(i.TextureLoader,e)},3277:function(e,t,r){r.d(t,{xC:function(){return p},k:function(){return c},WW:function(){return _}});var i=r(2248),n=r(7294),o=r(2212),s=r(9251);const a=(e,t=i.YQ.NORMAL)=>(0,n.forwardRef)((function({blendFunction:r,opacity:i,...o},s){const a=(0,n.useMemo)((()=>new e(o)),[o]);return(0,n.useLayoutEffect)((()=>{a.blendMode.blendFunction=r||t,void 0!==i&&(a.blendMode.opacity.value=i)}),[r,a.blendMode,i]),n.createElement("primitive",{ref:s,object:a,dispose:null})})),u=(e,t)=>{const r=e[t];return(0,n.useMemo)((()=>{if(r instanceof o.Vector2)return(new o.Vector2).set(r.x,r.y);if(Array.isArray(r)){const[e,t]=r;return(new o.Vector2).set(e,t)}}),[r])},m=()=>{try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},l=(a(i.rk,i.YQ.SCREEN),a(i.at),(0,n.forwardRef)((function(e,t){const r=u(e,"offset"),o=(0,n.useMemo)((()=>new i.YY({...e,offset:r})),[r,e]);return n.createElement("primitive",{ref:t,object:o,dispose:null})})),(0,n.forwardRef)((function({blendFunction:e=i.YQ.NORMAL},t){const r=(0,n.useMemo)((()=>new i.TC(e)),[e]);return n.createElement("primitive",{ref:t,object:r,dispose:null})})),a(i.zo),a(i.AL),(0,n.createContext)(null)),p=n.memo((0,n.forwardRef)((({children:e,camera:t,scene:r,renderPriority:o=1,autoClear:a=!0,depthBuffer:u,disableNormalPass:p,stencilBuffer:_,multisampling:c=8,frameBufferType:h},d)=>{const{gl:f,scene:v,camera:x,size:g}=(0,s.Ky)();r=r||v,t=t||x;const[y,b]=(0,n.useMemo)((()=>{const e=new i.xC(f,{depthBuffer:u,stencilBuffer:_,multisampling:m()?c:0,frameBufferType:h});e.addPass(new i.CD(r,t));const n=p?null:new i.gh(r,t);return n&&e.addPass(n),[e,n]}),[t,f,u,_,c,h,r,p]);(0,n.useEffect)((()=>null==y?void 0:y.setSize(g.width,g.height)),[y,g]),(0,s.xQ)(((e,t)=>(f.autoClear=a,void y.render(t))),o);const w=(0,n.useRef)(null);(0,n.useEffect)((()=>{let e;return w.current&&w.current.__r3f&&y&&(e=new i.H5(t,...w.current.__r3f.objects),y.addPass(e),e.renderToScreen=!0),()=>{e&&(null==y||y.removePass(e))}}),[y,e,t]);const M=(0,n.useMemo)((()=>({composer:y,normalPass:b,camera:t,scene:r})),[y,b,t,r]);return(0,n.useImperativeHandle)(d,(()=>y),[y]),n.createElement(l.Provider,{value:M},n.createElement("group",{ref:w},e))}))),_=((0,n.forwardRef)((function({target:e,depthTexture:t,...r},s){const{camera:a}=(0,n.useContext)(l),u=(0,n.useMemo)((()=>new i.Jy(a,r)),[a,r]);return(0,n.useLayoutEffect)((()=>{if(e){const t=e instanceof o.Vector3?(new o.Vector3).set(e.x,e.y,e.z):(new o.Vector3).set(e[0],e[1],e[2]);u.target=t}t&&u.setDepthTexture(t.texture,t.packing)}),[e,t,u]),n.createElement("primitive",{ref:s,object:u,dispose:null})})),a(i.ol),(0,n.forwardRef)((function({active:e=!0,...t},r){const o=u(t,"delay"),s=u(t,"duration"),a=u(t,"strength"),m=(0,n.useMemo)((()=>new i.sy({...t,delay:o,duration:s,strength:a})),[o,s,t,a]);return(0,n.useLayoutEffect)((()=>{m.mode=e?t.mode||i.O7.SPORADIC:i.O7.DISABLED}),[e,m,t.mode]),n.createElement("primitive",{ref:r,object:m,dispose:null})})),(0,n.forwardRef)((function(e,t){const{camera:r}=(0,n.useContext)(l),o=(0,n.useMemo)((()=>new i.KI(r,e.sun,e)),[r,e]);return n.createElement("primitive",{ref:t,object:o,dispose:null})})),(0,n.forwardRef)((function({size:e,...t},r){const o=(0,n.useMemo)((()=>new i.Qt(t)),[t]);return(0,n.useLayoutEffect)((()=>{e&&o.setSize(e.width,e.height)}),[o,e]),n.createElement("primitive",{ref:r,object:o,dispose:null})})),a(i.JL),a(i.xV,i.YQ.COLOR_DODGE),(0,n.forwardRef)((function({selection:e=[],selectionLayer:t=10,blendFunction:r,patternTexture:o,edgeStrength:s,pulseSpeed:a,visibleEdgeColor:u,hiddenEdgeColor:m,width:p,height:_,kernelSize:c,blur:h,xRay:d,...f},v){const{scene:x,camera:g}=(0,n.useContext)(l),y=(0,n.useMemo)((()=>new i.Mn(x,g,{blendFunction:r,patternTexture:o,edgeStrength:s,pulseSpeed:a,visibleEdgeColor:u,hiddenEdgeColor:m,width:p,height:_,kernelSize:c,blur:h,xRay:d})),[r,h,g,s,_,m,c,o,a,x,u,p,d]);return(0,n.useEffect)((()=>{y.clearSelection(),y.setSelection(Array.isArray(e)?e.map((e=>e.current)):[e.current])}),[y,e]),(0,n.useEffect)((()=>{y.selectionLayer=t}),[y,t]),n.createElement("primitive",{ref:v,object:y,dispose:null})})),(0,n.forwardRef)((function({granularity:e=5},t){const r=(0,n.useMemo)((()=>new i.Qg(e)),[e]);return n.createElement("primitive",{ref:t,object:r,dispose:null})})),a(i.p$,i.YQ.OVERLAY),(0,n.forwardRef)((function({selection:e=[],selectionLayer:t=10,lights:r=[],luminanceThreshold:o,luminanceSmoothing:s,intensity:a,width:u,height:m,kernelSize:p},_){0===r.length&&console.warn("SelectiveBloom requires lights to work.");const{scene:c,camera:h}=(0,n.useContext)(l),d=(0,n.useMemo)((()=>new i.V$(c,h,{blendFunction:i.YQ.SCREEN,luminanceThreshold:o,luminanceSmoothing:s,intensity:a,width:u,height:m,kernelSize:p})),[h,m,a,p,s,o,c,u]);return(0,n.useEffect)((()=>{d.selection.set(Array.isArray(e)?e.map((e=>e.current)):[e.current])}),[d,e]),(0,n.useEffect)((()=>{d.selection.layer=t}),[d,t]),(0,n.useEffect)((()=>(r.forEach((e=>((e,t)=>{e.current&&e.current.layers.enable(t.selection.layer)})(e,d))),()=>r.forEach((e=>((e,t)=>{e.current&&e.current.layers.disable(t.selection.layer)})(e,d))))),[d,r,t]),n.createElement("primitive",{ref:_,object:d,dispose:null})}))),c=(a(i.wL),(0,n.forwardRef)((function(e,t){const{camera:r,normalPass:o}=(0,n.useContext)(l),s=(0,n.useMemo)((()=>null===o?(console.error("Please enable the NormalPass in the EffectComposer in order to use SSAO."),null):new i.bn(r,o.renderTarget.texture,{blendFunction:i.YQ.MULTIPLY,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,scale:.5,bias:.5,...e})),[r,o,e]);return n.createElement("primitive",{ref:t,object:s,dispose:null})})),(0,n.forwardRef)((function({preset:e=i.F9.HIGH,edgeDetectionMode:t=i.HN.COLOR},r){const o=(0,s.U2)(i.hB,""),a=(0,n.useMemo)((()=>new i.fY(...o,e,t)),[o,e,t]);return n.createElement("primitive",{ref:r,object:a,dispose:null})})));(0,n.forwardRef)((function({textureSrc:e,texture:t,...r},a){const u=(0,s.U2)(o.TextureLoader,e);(0,n.useLayoutEffect)((()=>{u.encoding=o.sRGBEncoding,u.wrapS=u.wrapT=o.RepeatWrapping}),[u]);const m=(0,n.useMemo)((()=>new i.tq({...r,texture:u||t})),[r,u,t]);return n.createElement("primitive",{ref:a,object:m,dispose:null})})),a(i.M4),a(i.Dd),a(i.Uy),(0,n.forwardRef)((function({lut:e,tetrahedralInterpolation:t,...r},o){const s=(0,n.useMemo)((()=>new i.YH(e,r)),[e,r]);return(0,n.useLayoutEffect)((()=>{e&&s.setLUT(e),t&&s.setTetrahedralInterpolationEnabled(t)}),[s,e,t]),n.createElement("primitive",{ref:o,object:s,dispose:null})}))},7625:function(e,t,r){function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(i=r.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(u){a=!0,n=u}finally{try{s||null==r.return||r.return()}finally{if(a)throw n}}return o}}(e,t)||function(e,t){if(e){if("string"===typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.d(t,{Z:function(){return n}})}}]);