(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{7831:function(e,t,r){"use strict";r.d(t,{i:function(){return a}});var n=r(7294),i=r(9698),o=r(4942);class s{constructor(e=Math){(0,o.Z)(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),(0,o.Z)(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),(0,o.Z)(this,"p",[]),(0,o.Z)(this,"perm",[]),(0,o.Z)(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),(0,o.Z)(this,"dot",((e,t,r)=>e[0]*t+e[1]*r)),(0,o.Z)(this,"dot3",((e,t,r,n)=>e[0]*t+e[1]*r+e[2]*n)),(0,o.Z)(this,"dot4",((e,t,r,n,i)=>e[0]*t+e[1]*r+e[2]*n+e[3]*i)),(0,o.Z)(this,"noise",((e,t)=>{let r,n,i;const o=(e+t)*(.5*(Math.sqrt(3)-1)),s=Math.floor(e+o),a=Math.floor(t+o),l=(3-Math.sqrt(3))/6,u=(s+a)*l,c=e-(s-u),h=t-(a-u);let f=0,d=1;c>h&&(f=1,d=0);const p=c-f+l,m=h-d+l,x=c-1+2*l,v=h-1+2*l,y=255&s,g=255&a,b=this.perm[y+this.perm[g]]%12,w=this.perm[y+f+this.perm[g+d]]%12,M=this.perm[y+1+this.perm[g+1]]%12;let T=.5-c*c-h*h;T<0?r=0:(T*=T,r=T*T*this.dot(this.grad3[b],c,h));let S=.5-p*p-m*m;S<0?n=0:(S*=S,n=S*S*this.dot(this.grad3[w],p,m));let _=.5-x*x-v*v;return _<0?i=0:(_*=_,i=_*_*this.dot(this.grad3[M],x,v)),70*(r+n+i)})),(0,o.Z)(this,"noise3d",((e,t,r)=>{let n,i,o,s;const a=(e+t+r)*(1/3),l=Math.floor(e+a),u=Math.floor(t+a),c=Math.floor(r+a),h=1/6,f=(l+u+c)*h,d=e-(l-f),p=t-(u-f),m=r-(c-f);let x,v,y,g,b,w;d>=p?p>=m?(x=1,v=0,y=0,g=1,b=1,w=0):d>=m?(x=1,v=0,y=0,g=1,b=0,w=1):(x=0,v=0,y=1,g=1,b=0,w=1):p<m?(x=0,v=0,y=1,g=0,b=1,w=1):d<m?(x=0,v=1,y=0,g=0,b=1,w=1):(x=0,v=1,y=0,g=1,b=1,w=0);const M=d-x+h,T=p-v+h,S=m-y+h,_=d-g+2*h,D=p-b+2*h,B=m-w+2*h,A=d-1+.5,k=p-1+.5,U=m-1+.5,P=255&l,C=255&u,R=255&c,E=this.perm[P+this.perm[C+this.perm[R]]]%12,V=this.perm[P+x+this.perm[C+v+this.perm[R+y]]]%12,F=this.perm[P+g+this.perm[C+b+this.perm[R+w]]]%12,I=this.perm[P+1+this.perm[C+1+this.perm[R+1]]]%12;let L=.6-d*d-p*p-m*m;L<0?n=0:(L*=L,n=L*L*this.dot3(this.grad3[E],d,p,m));let N=.6-M*M-T*T-S*S;N<0?i=0:(N*=N,i=N*N*this.dot3(this.grad3[V],M,T,S));let z=.6-_*_-D*D-B*B;z<0?o=0:(z*=z,o=z*z*this.dot3(this.grad3[F],_,D,B));let O=.6-A*A-k*k-U*U;return O<0?s=0:(O*=O,s=O*O*this.dot3(this.grad3[I],A,k,U)),32*(n+i+o+s)})),(0,o.Z)(this,"noise4d",((e,t,r,n)=>{const i=this.grad4,o=this.simplex,s=this.perm,a=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let u,c,h,f,d;const p=(e+t+r+n)*a,m=Math.floor(e+p),x=Math.floor(t+p),v=Math.floor(r+p),y=Math.floor(n+p),g=(m+x+v+y)*l,b=e-(m-g),w=t-(x-g),M=r-(v-g),T=n-(y-g),S=(b>w?32:0)+(b>M?16:0)+(w>M?8:0)+(b>T?4:0)+(w>T?2:0)+(M>T?1:0);let _,D,B,A,k,U,P,C,R,E,V,F;_=o[S][0]>=3?1:0,D=o[S][1]>=3?1:0,B=o[S][2]>=3?1:0,A=o[S][3]>=3?1:0,k=o[S][0]>=2?1:0,U=o[S][1]>=2?1:0,P=o[S][2]>=2?1:0,C=o[S][3]>=2?1:0,R=o[S][0]>=1?1:0,E=o[S][1]>=1?1:0,V=o[S][2]>=1?1:0,F=o[S][3]>=1?1:0;const I=b-_+l,L=w-D+l,N=M-B+l,z=T-A+l,O=b-k+2*l,W=w-U+2*l,j=M-P+2*l,q=T-C+2*l,G=b-R+3*l,H=w-E+3*l,Z=M-V+3*l,J=T-F+3*l,X=b-1+4*l,Y=w-1+4*l,Q=M-1+4*l,$=T-1+4*l,K=255&m,ee=255&x,te=255&v,re=255&y,ne=s[K+s[ee+s[te+s[re]]]]%32,ie=s[K+_+s[ee+D+s[te+B+s[re+A]]]]%32,oe=s[K+k+s[ee+U+s[te+P+s[re+C]]]]%32,se=s[K+R+s[ee+E+s[te+V+s[re+F]]]]%32,ae=s[K+1+s[ee+1+s[te+1+s[re+1]]]]%32;let le=.6-b*b-w*w-M*M-T*T;le<0?u=0:(le*=le,u=le*le*this.dot4(i[ne],b,w,M,T));let ue=.6-I*I-L*L-N*N-z*z;ue<0?c=0:(ue*=ue,c=ue*ue*this.dot4(i[ie],I,L,N,z));let ce=.6-O*O-W*W-j*j-q*q;ce<0?h=0:(ce*=ce,h=ce*ce*this.dot4(i[oe],O,W,j,q));let he=.6-G*G-H*H-Z*Z-J*J;he<0?f=0:(he*=he,f=he*he*this.dot4(i[se],G,H,Z,J));let fe=.6-X*X-Y*Y-Q*Q-$*$;return fe<0?d=0:(fe*=fe,d=fe*fe*this.dot4(i[ae],X,Y,Q,$)),27*(u+c+h+f+d)}));for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let t=0;t<512;t++)this.perm[t]=this.p[255&t]}}const a=n.forwardRef((({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:o=.1,maxPitch:a=.1,maxRoll:l=.1,yawFrequency:u=.1,pitchFrequency:c=.1,rollFrequency:h=.1,controls:f},d)=>{const p=(0,i.x)((e=>e.camera)),m=(0,i.x)((e=>e.controls)),x=n.useRef(e),v=n.useRef(p.rotation.clone()),[y]=n.useState((()=>new s)),[g]=n.useState((()=>new s)),[b]=n.useState((()=>new s)),w=()=>{(x.current<0||x.current>1)&&(x.current=x.current<0?0:1)};return n.useImperativeHandle(d,(()=>({getIntensity:()=>x.current,setIntensity:e=>{x.current=e,w()}})),[]),n.useEffect((()=>{const e=m||(null==f?void 0:f.current),t=()=>{v.current=p.rotation.clone()};return null==e||e.addEventListener("change",t),()=>{null==e||e.removeEventListener("change",t)}}),[f,m]),(0,i.y)((({clock:e},n)=>{const i=Math.pow(x.current,2),s=o*i*y.noise(e.elapsedTime*u,1),f=a*i*g.noise(e.elapsedTime*c,1),d=l*i*b.noise(e.elapsedTime*h,1);p.rotation.set(v.current.x+f,v.current.y+s,v.current.z+d),t&&x.current>0&&(x.current-=r*n,w())})),null}))},3218:function(e,t,r){"use strict";r.d(t,{r:function(){return h}});var n=r(7462),i=r(7294),o=r(9477),s=r(9698),a=r(5878);class l extends o.ShaderMaterial{constructor(e=new o.Vector2){super({uniforms:{inputBuffer:new o.Uniform(null),depthBuffer:new o.Uniform(null),resolution:new o.Uniform(new o.Vector2),texelSize:new o.Uniform(new o.Vector2),halfTexelSize:new o.Uniform(new o.Vector2),kernel:new o.Uniform(0),scale:new o.Uniform(1),cameraNear:new o.Uniform(0),cameraFar:new o.Uniform(1),minDepthThreshold:new o.Uniform(0),maxDepthThreshold:new o.Uniform(1),depthScale:new o.Uniform(0),depthToBlurRatioBias:new o.Uniform(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n          #include <tonemapping_fragment>\n          #include <encodings_fragment>\n        }",vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:o.NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class u{constructor({gl:e,resolution:t,width:r=500,height:n=500,minDepthThreshold:i=0,maxDepthThreshold:s=1,depthScale:a=0,depthToBlurRatioBias:u=.25}){this.renderToScreen=!1,this.renderTargetA=new o.WebGLRenderTarget(t,t,{minFilter:o.LinearFilter,magFilter:o.LinearFilter,stencilBuffer:!1,depthBuffer:!1,encoding:e.outputEncoding}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new l,this.convolutionMaterial.setTexelSize(1/r,1/n),this.convolutionMaterial.setResolution(new o.Vector2(r,n)),this.scene=new o.Scene,this.camera=new o.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=i,this.convolutionMaterial.uniforms.maxDepthThreshold.value=s,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=u,this.convolutionMaterial.defines.USE_DEPTH=a>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),h=new Float32Array([0,0,2,0,0,2]),f=new o.BufferGeometry;f.setAttribute("position",new o.BufferAttribute(c,3)),f.setAttribute("uv",new o.BufferAttribute(h,2)),this.screen=new o.Mesh(f,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,r){const n=this.scene,i=this.camera,o=this.renderTargetA,s=this.renderTargetB;let a=this.convolutionMaterial,l=a.uniforms;l.depthBuffer.value=t.depthTexture;const u=a.kernel;let c,h,f,d=t;for(h=0,f=u.length-1;h<f;++h)c=0===(1&h)?o:s,l.kernel.value=u[h],l.inputBuffer.value=d.texture,e.setRenderTarget(c),e.render(n,i),d=c;l.kernel.value=u[h],l.inputBuffer.value=d.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(n,i)}}class c extends o.MeshStandardMaterial{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;\n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n\n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n\n      vec4 merge = base;\n\n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n\n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n\n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);\n      ")}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}(0,s.e)({MeshReflectorMaterial:c});const h=i.forwardRef((({mixBlur:e=0,mixStrength:t=.5,resolution:r=256,blur:l=[0,0],args:c=[1,1],minDepthThreshold:h=.9,maxDepthThreshold:f=1,depthScale:d=0,depthToBlurRatioBias:p=.25,mirror:m=0,children:x,debug:v=0,distortion:y=1,mixContrast:g=1,distortionMap:b,...w},M)=>{i.useEffect((()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")}),[]);const T=(0,s.x)((({gl:e})=>e)),S=(0,s.x)((({camera:e})=>e)),_=(0,s.x)((({scene:e})=>e)),D=(l=Array.isArray(l)?l:[l,l])[0]+l[1]>0,B=i.useRef(null),[A]=i.useState((()=>new o.Plane)),[k]=i.useState((()=>new o.Vector3)),[U]=i.useState((()=>new o.Vector3)),[P]=i.useState((()=>new o.Vector3)),[C]=i.useState((()=>new o.Matrix4)),[R]=i.useState((()=>new o.Vector3(0,0,-1))),[E]=i.useState((()=>new o.Vector4)),[V]=i.useState((()=>new o.Vector3)),[F]=i.useState((()=>new o.Vector3)),[I]=i.useState((()=>new o.Vector4)),[L]=i.useState((()=>new o.Matrix4)),[N]=i.useState((()=>new o.PerspectiveCamera)),z=i.useCallback((()=>{if(U.setFromMatrixPosition(B.current.matrixWorld),P.setFromMatrixPosition(S.matrixWorld),C.extractRotation(B.current.matrixWorld),k.set(0,0,1),k.applyMatrix4(C),V.subVectors(U,P),V.dot(k)>0)return;V.reflect(k).negate(),V.add(U),C.extractRotation(S.matrixWorld),R.set(0,0,-1),R.applyMatrix4(C),R.add(P),F.subVectors(U,R),F.reflect(k).negate(),F.add(U),N.position.copy(V),N.up.set(0,1,0),N.up.applyMatrix4(C),N.up.reflect(k),N.lookAt(F),N.far=S.far,N.updateMatrixWorld(),N.projectionMatrix.copy(S.projectionMatrix),L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(N.projectionMatrix),L.multiply(N.matrixWorldInverse),L.multiply(B.current.matrixWorld),A.setFromNormalAndCoplanarPoint(k,U),A.applyMatrix4(N.matrixWorldInverse),E.set(A.normal.x,A.normal.y,A.normal.z,A.constant);const e=N.projectionMatrix;I.x=(Math.sign(E.x)+e.elements[8])/e.elements[0],I.y=(Math.sign(E.y)+e.elements[9])/e.elements[5],I.z=-1,I.w=(1+e.elements[10])/e.elements[14],E.multiplyScalar(2/E.dot(I)),e.elements[2]=E.x,e.elements[6]=E.y,e.elements[10]=E.z+1,e.elements[14]=E.w}),[]),[O,W,j,q]=i.useMemo((()=>{const n={minFilter:o.LinearFilter,magFilter:o.LinearFilter,encoding:T.outputEncoding},i=new o.WebGLRenderTarget(r,r,n);i.depthBuffer=!0,i.depthTexture=new o.DepthTexture(r,r),i.depthTexture.format=o.DepthFormat,i.depthTexture.type=o.UnsignedShortType;const s=new o.WebGLRenderTarget(r,r,n);return[i,s,new u({gl:T,resolution:r,width:l[0],height:l[1],minDepthThreshold:h,maxDepthThreshold:f,depthScale:d,depthToBlurRatioBias:p}),{mirror:m,textureMatrix:L,mixBlur:e,tDiffuse:i.texture,tDepth:i.depthTexture,tDiffuseBlur:s.texture,hasBlur:D,mixStrength:t,minDepthThreshold:h,maxDepthThreshold:f,depthScale:d,depthToBlurRatioBias:p,transparent:!0,debug:v,distortion:y,distortionMap:b,mixContrast:g,"defines-USE_BLUR":D?"":void 0,"defines-USE_DEPTH":d>0?"":void 0,"defines-USE_DISTORTION":b?"":void 0}]}),[T,l,L,r,m,D,e,t,h,f,d,p,v,y,b,g]);return(0,s.y)((()=>{if(null==B||!B.current)return;B.current.visible=!1;const e=T.xr.enabled,t=T.shadowMap.autoUpdate;z(),T.xr.enabled=!1,T.shadowMap.autoUpdate=!1,T.setRenderTarget(O),T.state.buffers.depth.setMask(!0),T.autoClear||T.clear(),T.render(_,N),D&&j.render(T,O,W),T.xr.enabled=e,T.shadowMap.autoUpdate=t,B.current.visible=!0,T.setRenderTarget(null)})),i.createElement("mesh",(0,n.Z)({ref:(0,a.Z)([B,M])},w),i.createElement("planeBufferGeometry",{args:c}),x?x("meshReflectorMaterial",q):i.createElement("meshReflectorMaterial",q))}))},1033:function(e,t,r){"use strict";r.d(t,{j:function(){return l}});var n=r(7294),i=r(9698),o=r(3466),s=r.n(o);function a(e,t){"function"===typeof e?e(t):null!=e&&(e.current=t)}function l({showPanel:e=0,className:t,parent:r}){const o=function(e,t=[],r){const[i,o]=n.useState();return n.useLayoutEffect((()=>{const t=e();return o(t),a(r,t),()=>a(r,null)}),t),i}((()=>new(s())),[]);return n.useEffect((()=>{if(o){const n=r&&r.current||document.body;o.showPanel(e),null==n||n.appendChild(o.dom),t&&o.dom.classList.add(...t.split(" ").filter((e=>e)));const s=(0,i.l)((()=>o.begin())),a=(0,i.m)((()=>o.end()));return()=>{null==n||n.removeChild(o.dom),s(),a()}}}),[r,o,t,e]),null}},5769:function(e,t,r){"use strict";r.d(t,{m:function(){return a}});var n=r(9477),i=r(9698),o=r(7294);const s=e=>e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e;function a(e){const t=(0,i.x)((e=>e.gl)),r=(0,i.A)(n.TextureLoader,s(e)?Object.values(e):e);if((0,o.useEffect)((()=>{(Array.isArray(r)?r:[r]).forEach(t.initTexture)}),[t,r]),s(e)){const t=Object.keys(e),n={};return t.forEach((e=>Object.assign(n,{[e]:r[t.indexOf(e)]}))),n}return r}a.preload=e=>i.A.preload(n.TextureLoader,e),a.clear=e=>i.A.clear(n.TextureLoader,e)},3466:function(e){e.exports=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function r(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";n=e}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),r(++n%i.children.length)}),!1);var o=(performance||Date).now(),s=o,a=0,l=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:i,addPanel:t,showPanel:r,begin:function(){o=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(u.update(e-o,200),e>s+1e3&&(l.update(1e3*a/(e-s),100),s=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:i,setMode:r}};return e.Panel=function(e,t,r){var n=1/0,i=0,o=Math.round,s=o(window.devicePixelRatio||1),a=80*s,l=48*s,u=3*s,c=2*s,h=3*s,f=15*s,d=74*s,p=30*s,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var x=m.getContext("2d");return x.font="bold "+9*s+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=r,x.fillRect(0,0,a,l),x.fillStyle=t,x.fillText(e,u,c),x.fillRect(h,f,d,p),x.fillStyle=r,x.globalAlpha=.9,x.fillRect(h,f,d,p),{dom:m,update:function(l,v){n=Math.min(n,l),i=Math.max(i,l),x.fillStyle=r,x.globalAlpha=1,x.fillRect(0,0,a,f),x.fillStyle=t,x.fillText(o(l)+" "+e+" ("+o(n)+"-"+o(i)+")",u,c),x.drawImage(m,h+s,f,d-s,p,h,f,d-s,p),x.fillRect(h+d-s,f,s,p),x.fillStyle=r,x.globalAlpha=.9,x.fillRect(h+d-s,f,s,o((1-l/v)*p))}}},e}()},4942:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,{Z:function(){return n}})},1367:function(e,t,r){"use strict";r.d(t,{u:function(){return i}});var n=r(9477);class i extends n.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,r,i){const o=this,s=new n.FileLoader(o.manager);s.setPath(o.path),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(e,(function(r){try{t(o.parse(r))}catch(n){i?i(n):console.error(n),o.manager.itemError(e)}}),r,i)}parse(e){const t=this;function r(e,t,r,n,o,s,a,l){if(0==t||0==r)return void e.lineTo(l.x,l.y);n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);const u=(a.x-l.x)/2,c=(a.y-l.y)/2,h=Math.cos(n)*u+Math.sin(n)*c,f=-Math.sin(n)*u+Math.cos(n)*c;let d=t*t,p=r*r;const m=h*h,x=f*f,v=m/d+x/p;if(v>1){const e=Math.sqrt(v);d=(t*=e)*t,p=(r*=e)*r}const y=d*x+p*m,g=(d*p-y)/y;let b=Math.sqrt(Math.max(0,g));o===s&&(b=-b);const w=b*t*f/r,M=-b*r*h/t,T=Math.cos(n)*w-Math.sin(n)*M+(a.x+l.x)/2,S=Math.sin(n)*w+Math.cos(n)*M+(a.y+l.y)/2,_=i(1,0,(h-w)/t,(f-M)/r),D=i((h-w)/t,(f-M)/r,(-h-w)/t,(-f-M)/r)%(2*Math.PI);e.currentPath.absellipse(T,S,t,r,_,_+D,0===s,n)}function i(e,t,r,n){const i=e*r+t*n,o=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n);let s=Math.acos(Math.max(-1,Math.min(1,i/o)));return e*n-t*r<0&&(s=-s),s}function o(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)r=Object.assign(r,p["."+t[e]])}function n(n,i,o){void 0===o&&(o=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(n)&&(t[i]=o(e.getAttribute(n))),r[n]&&(t[i]=o(r[n])),e.style&&""!==e.style[n]&&(t[i]=o(e.style[n]))}function i(e){return Math.max(0,Math.min(1,c(e)))}function o(e){return Math.max(0,c(e))}return e.hasAttribute("id")&&(r=Object.assign(r,p["#"+e.getAttribute("id")])),n("fill","fill"),n("fill-opacity","fillOpacity",i),n("fill-rule","fillRule"),n("opacity","opacity",i),n("stroke","stroke"),n("stroke-opacity","strokeOpacity",i),n("stroke-width","strokeWidth",o),n("stroke-linejoin","strokeLineJoin"),n("stroke-linecap","strokeLineCap"),n("stroke-miterlimit","strokeMiterLimit",o),n("visibility","visibility"),t}function s(e,t){return e-(t-e)}function a(e,t,r){if("string"!==typeof e)throw new TypeError("Invalid input: "+typeof e);const n={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let i=0,o=!0,s="",a="";const l=[];function u(e,t,r){const n=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw n.partial=r,n}function c(){""!==s&&(""===a?l.push(Number(s)):l.push(Number(s)*Math.pow(10,Number(a)))),s="",a=""}let h;const f=e.length;for(let d=0;d<f;d++)if(h=e[d],Array.isArray(t)&&t.includes(l.length%r)&&n.FLAGS.test(h))i=1,s=h,c();else{if(0===i){if(n.WHITESPACE.test(h))continue;if(n.DIGIT.test(h)||n.SIGN.test(h)){i=1,s=h;continue}if(n.POINT.test(h)){i=2,s=h;continue}n.COMMA.test(h)&&(o&&u(h,d,l),o=!0)}if(1===i){if(n.DIGIT.test(h)){s+=h;continue}if(n.POINT.test(h)){s+=h,i=2;continue}if(n.EXP.test(h)){i=3;continue}n.SIGN.test(h)&&1===s.length&&n.SIGN.test(s[0])&&u(h,d,l)}if(2===i){if(n.DIGIT.test(h)){s+=h;continue}if(n.EXP.test(h)){i=3;continue}n.POINT.test(h)&&"."===s[s.length-1]&&u(h,d,l)}if(3===i){if(n.DIGIT.test(h)){a+=h;continue}if(n.SIGN.test(h)){if(""===a){a+=h;continue}1===a.length&&n.SIGN.test(a)&&u(h,d,l)}}n.WHITESPACE.test(h)?(c(),i=0,o=!1):n.COMMA.test(h)?(c(),i=0,o=!0):n.SIGN.test(h)?(c(),i=1,s=h):n.POINT.test(h)?(c(),i=2,s=h):u(h,d,l)}return c(),l}const l=["mm","cm","in","pt","pc","px"],u={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(e){let r,n="px";if("string"===typeof e||e instanceof String)for(let t=0,i=l.length;t<i;t++){const r=l[t];if(e.endsWith(r)){n=r,e=e.substring(0,e.length-r.length);break}}return"px"===n&&"px"!==t.defaultUnit?r=u.in[t.defaultUnit]/t.defaultDPI:(r=u[n][t.defaultUnit],r<0&&(r=u[n].in*t.defaultDPI)),r*parseFloat(e)}function h(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function f(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const d=[],p={},m=[],x=new n.Matrix3,v=new n.Matrix3,y=new n.Matrix3,g=new n.Matrix3,b=new n.Vector2,w=new n.Vector3,M=new n.Matrix3,T=(new DOMParser).parseFromString(e,"image/svg+xml");!function e(t,i){if(1!==t.nodeType)return;const l=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;const t=function(e){const t=new n.Matrix3,r=x;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){const r=c(e.getAttribute("x")),n=c(e.getAttribute("y"));t.translate(r,n)}if(e.hasAttribute("transform")){const n=e.getAttribute("transform").split(")");for(let e=n.length-1;e>=0;e--){const i=n[e].trim();if(""===i)continue;const o=i.indexOf("("),s=i.length;if(o>0&&o<s){const e=i.slice(0,o),t=a(i.slice(o+1));switch(r.identity(),e){case"translate":if(t.length>=1){const e=t[0];let n=e;t.length>=2&&(n=t[1]),r.translate(e,n)}break;case"rotate":if(t.length>=1){let e=0,n=0,i=0;e=-t[0]*Math.PI/180,t.length>=3&&(n=t[1],i=t[2]),v.identity().translate(-n,-i),y.identity().rotate(e),g.multiplyMatrices(y,v),v.identity().translate(n,i),r.multiplyMatrices(v,g)}break;case"scale":if(t.length>=1){const e=t[0];let n=e;t.length>=2&&(n=t[1]),r.scale(e,n)}break;case"skewX":1===t.length&&r.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&r.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&r.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(r)}}return t}(e);m.length>0&&t.premultiply(m[m.length-1]);return M.copy(t),m.push(t),t}(t);let u=!1,T=null;switch(t.nodeName){case"svg":break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const r=e.sheet.cssRules[t];if(1!==r.type)continue;const n=r.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<n.length;e++){const t=Object.fromEntries(Object.entries(r.style).filter((([,e])=>""!==e)));p[n[e]]=Object.assign(p[n[e]]||{},t)}}}(t);break;case"g":i=o(t,i);break;case"path":i=o(t,i),t.hasAttribute("d")&&(T=function(e){const t=new n.ShapePath,i=new n.Vector2,o=new n.Vector2,l=new n.Vector2;let u=!0,c=!1;const h=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let n=0,f=h.length;n<f;n++){const e=h[n],f=e.charAt(0),d=e.slice(1).trim();let p;switch(!0===u&&(c=!0,u=!1),f){case"M":p=a(d);for(let e=0,r=p.length;e<r;e+=2)i.x=p[e+0],i.y=p[e+1],o.x=i.x,o.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&l.copy(i);break;case"H":p=a(d);for(let e=0,r=p.length;e<r;e++)i.x=p[e],o.x=i.x,o.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&l.copy(i);break;case"V":p=a(d);for(let e=0,r=p.length;e<r;e++)i.y=p[e],o.x=i.x,o.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&l.copy(i);break;case"L":p=a(d);for(let e=0,r=p.length;e<r;e+=2)i.x=p[e+0],i.y=p[e+1],o.x=i.x,o.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&l.copy(i);break;case"C":p=a(d);for(let e=0,r=p.length;e<r;e+=6)t.bezierCurveTo(p[e+0],p[e+1],p[e+2],p[e+3],p[e+4],p[e+5]),o.x=p[e+2],o.y=p[e+3],i.x=p[e+4],i.y=p[e+5],0===e&&!0===c&&l.copy(i);break;case"S":p=a(d);for(let e=0,r=p.length;e<r;e+=4)t.bezierCurveTo(s(i.x,o.x),s(i.y,o.y),p[e+0],p[e+1],p[e+2],p[e+3]),o.x=p[e+0],o.y=p[e+1],i.x=p[e+2],i.y=p[e+3],0===e&&!0===c&&l.copy(i);break;case"Q":p=a(d);for(let e=0,r=p.length;e<r;e+=4)t.quadraticCurveTo(p[e+0],p[e+1],p[e+2],p[e+3]),o.x=p[e+0],o.y=p[e+1],i.x=p[e+2],i.y=p[e+3],0===e&&!0===c&&l.copy(i);break;case"T":p=a(d);for(let e=0,r=p.length;e<r;e+=2){const r=s(i.x,o.x),n=s(i.y,o.y);t.quadraticCurveTo(r,n,p[e+0],p[e+1]),o.x=r,o.y=n,i.x=p[e+0],i.y=p[e+1],0===e&&!0===c&&l.copy(i)}break;case"A":p=a(d,[3,4],7);for(let e=0,n=p.length;e<n;e+=7){if(p[e+5]==i.x&&p[e+6]==i.y)continue;const n=i.clone();i.x=p[e+5],i.y=p[e+6],o.x=i.x,o.y=i.y,r(t,p[e],p[e+1],p[e+2],p[e+3],p[e+4],n,i),0===e&&!0===c&&l.copy(i)}break;case"m":p=a(d);for(let e=0,r=p.length;e<r;e+=2)i.x+=p[e+0],i.y+=p[e+1],o.x=i.x,o.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&l.copy(i);break;case"h":p=a(d);for(let e=0,r=p.length;e<r;e++)i.x+=p[e],o.x=i.x,o.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&l.copy(i);break;case"v":p=a(d);for(let e=0,r=p.length;e<r;e++)i.y+=p[e],o.x=i.x,o.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&l.copy(i);break;case"l":p=a(d);for(let e=0,r=p.length;e<r;e+=2)i.x+=p[e+0],i.y+=p[e+1],o.x=i.x,o.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===c&&l.copy(i);break;case"c":p=a(d);for(let e=0,r=p.length;e<r;e+=6)t.bezierCurveTo(i.x+p[e+0],i.y+p[e+1],i.x+p[e+2],i.y+p[e+3],i.x+p[e+4],i.y+p[e+5]),o.x=i.x+p[e+2],o.y=i.y+p[e+3],i.x+=p[e+4],i.y+=p[e+5],0===e&&!0===c&&l.copy(i);break;case"s":p=a(d);for(let e=0,r=p.length;e<r;e+=4)t.bezierCurveTo(s(i.x,o.x),s(i.y,o.y),i.x+p[e+0],i.y+p[e+1],i.x+p[e+2],i.y+p[e+3]),o.x=i.x+p[e+0],o.y=i.y+p[e+1],i.x+=p[e+2],i.y+=p[e+3],0===e&&!0===c&&l.copy(i);break;case"q":p=a(d);for(let e=0,r=p.length;e<r;e+=4)t.quadraticCurveTo(i.x+p[e+0],i.y+p[e+1],i.x+p[e+2],i.y+p[e+3]),o.x=i.x+p[e+0],o.y=i.y+p[e+1],i.x+=p[e+2],i.y+=p[e+3],0===e&&!0===c&&l.copy(i);break;case"t":p=a(d);for(let e=0,r=p.length;e<r;e+=2){const r=s(i.x,o.x),n=s(i.y,o.y);t.quadraticCurveTo(r,n,i.x+p[e+0],i.y+p[e+1]),o.x=r,o.y=n,i.x=i.x+p[e+0],i.y=i.y+p[e+1],0===e&&!0===c&&l.copy(i)}break;case"a":p=a(d,[3,4],7);for(let e=0,n=p.length;e<n;e+=7){if(0==p[e+5]&&0==p[e+6])continue;const n=i.clone();i.x+=p[e+5],i.y+=p[e+6],o.x=i.x,o.y=i.y,r(t,p[e],p[e+1],p[e+2],p[e+3],p[e+4],n,i),0===e&&!0===c&&l.copy(i)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(i.copy(l),t.currentPath.currentPoint.copy(i),u=!0);break;default:console.warn(e)}c=!1}return t}(t));break;case"rect":i=o(t,i),T=function(e){const t=c(e.getAttribute("x")||0),r=c(e.getAttribute("y")||0),i=c(e.getAttribute("rx")||e.getAttribute("ry")||0),o=c(e.getAttribute("ry")||e.getAttribute("rx")||0),s=c(e.getAttribute("width")),a=c(e.getAttribute("height")),l=.448084975506,u=new n.ShapePath;u.moveTo(t+i,r),u.lineTo(t+s-i,r),(0!==i||0!==o)&&u.bezierCurveTo(t+s-i*l,r,t+s,r+o*l,t+s,r+o);u.lineTo(t+s,r+a-o),(0!==i||0!==o)&&u.bezierCurveTo(t+s,r+a-o*l,t+s-i*l,r+a,t+s-i,r+a);u.lineTo(t+i,r+a),(0!==i||0!==o)&&u.bezierCurveTo(t+i*l,r+a,t,r+a-o*l,t,r+a-o);u.lineTo(t,r+o),(0!==i||0!==o)&&u.bezierCurveTo(t,r+o*l,t+i*l,r,t+i,r);return u}(t);break;case"polygon":i=o(t,i),T=function(e){function t(e,t,r){const n=c(t),s=c(r);0===o?i.moveTo(n,s):i.lineTo(n,s),o++}const r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,i=new n.ShapePath;let o=0;return e.getAttribute("points").replace(r,t),i.currentPath.autoClose=!0,i}(t);break;case"polyline":i=o(t,i),T=function(e){function t(e,t,r){const n=c(t),s=c(r);0===o?i.moveTo(n,s):i.lineTo(n,s),o++}const r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,i=new n.ShapePath;let o=0;return e.getAttribute("points").replace(r,t),i.currentPath.autoClose=!1,i}(t);break;case"circle":i=o(t,i),T=function(e){const t=c(e.getAttribute("cx")||0),r=c(e.getAttribute("cy")||0),i=c(e.getAttribute("r")||0),o=new n.Path;o.absarc(t,r,i,0,2*Math.PI);const s=new n.ShapePath;return s.subPaths.push(o),s}(t);break;case"ellipse":i=o(t,i),T=function(e){const t=c(e.getAttribute("cx")||0),r=c(e.getAttribute("cy")||0),i=c(e.getAttribute("rx")||0),o=c(e.getAttribute("ry")||0),s=new n.Path;s.absellipse(t,r,i,o,0,2*Math.PI);const a=new n.ShapePath;return a.subPaths.push(s),a}(t);break;case"line":i=o(t,i),T=function(e){const t=c(e.getAttribute("x1")||0),r=c(e.getAttribute("y1")||0),i=c(e.getAttribute("x2")||0),o=c(e.getAttribute("y2")||0),s=new n.ShapePath;return s.moveTo(t,r),s.lineTo(i,o),s.currentPath.autoClose=!1,s}(t);break;case"defs":u=!0;break;case"use":i=o(t,i);const l=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),h=t.viewportElement.getElementById(l);h?e(h,i):console.warn("SVGLoader: 'use node' references non-existent node id: "+l)}T&&(void 0!==i.fill&&"none"!==i.fill&&T.color.setStyle(i.fill),function(e,t){function r(e){w.set(e.x,e.y,1).applyMatrix3(t),e.set(w.x,w.y)}const n=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),i=e.subPaths;for(let o=0,s=i.length;o<s;o++){const e=i[o].curves;for(let i=0;i<e.length;i++){const o=e[i];o.isLineCurve?(r(o.v1),r(o.v2)):o.isCubicBezierCurve?(r(o.v0),r(o.v1),r(o.v2),r(o.v3)):o.isQuadraticBezierCurve?(r(o.v0),r(o.v1),r(o.v2)):o.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),b.set(o.aX,o.aY),r(b),o.aX=b.x,o.aY=b.y,o.xRadius*=h(t),o.yRadius*=f(t))}}}(T,M),d.push(T),T.userData={node:t,style:i});const S=t.childNodes;for(let r=0;r<S.length;r++){const t=S[r];u&&"style"!==t.nodeName&&"defs"!==t.nodeName||e(t,i)}l&&(m.pop(),m.length>0?M.copy(m[m.length-1]):M.identity())}(T.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:d,xml:T.documentElement}}static createShapes(e){const t=999999999,r=0,i=1,o=2,s=3,a=4,l=5,u=6,c={loc:r,t:0};function h(e,t,n,i){const s=e.x,a=t.x,l=n.x,u=i.x,h=e.y,d=t.y,p=n.y,m=i.y,x=(u-l)*(h-p)-(m-p)*(s-l),v=(m-p)*(a-s)-(u-l)*(d-h),y=x/v,g=((a-s)*(h-p)-(d-h)*(s-l))/v;if(0===v&&0!==x||y<=0||y>=1||g<0||g>1)return null;if(0===x&&0===v){for(let l=0;l<2;l++){if(f(0===l?n:i,e,t),c.loc==r){const e=0===l?n:i;return{x:e.x,y:e.y,t:c.t}}if(c.loc==o){return{x:+(s+c.t*(a-s)).toPrecision(10),y:+(h+c.t*(d-h)).toPrecision(10),t:c.t}}}return null}for(let o=0;o<2;o++)if(f(0===o?n:i,e,t),c.loc==r){const e=0===o?n:i;return{x:e.x,y:e.y,t:c.t}}return{x:+(s+y*(a-s)).toPrecision(10),y:+(h+y*(d-h)).toPrecision(10),t:y}}function f(e,t,n){const h=n.x-t.x,f=n.y-t.y,d=e.x-t.x,p=e.y-t.y,m=h*p-d*f;if(e.x===t.x&&e.y===t.y)return c.loc=r,void(c.t=0);if(e.x===n.x&&e.y===n.y)return c.loc=i,void(c.t=1);if(m<-Number.EPSILON)return void(c.loc=s);if(m>Number.EPSILON)return void(c.loc=a);if(h*d<0||f*p<0)return void(c.loc=l);if(Math.sqrt(h*h+f*f)<Math.sqrt(d*d+p*p))return void(c.loc=u);let x;x=0!==h?d/h:p/f,c.loc=o,c.t=x}function d(e,t,r){const i=new n.Vector2;t.getCenter(i);const o=[];return r.forEach((t=>{if(t.boundingBox.containsPoint(i)){(function(e,t){const r=[],i=[];for(let o=1;o<e.length;o++){const s=e[o-1],a=e[o];for(let e=1;e<t.length;e++){const o=h(s,a,t[e-1],t[e]);null!==o&&void 0===r.find((e=>e.t<=o.t+Number.EPSILON&&e.t>=o.t-Number.EPSILON))&&(r.push(o),i.push(new n.Vector2(o.x,o.y)))}}return i})(e,t.points).forEach((e=>{o.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),o.sort(((e,t)=>e.point.x-t.point.x)),o}let p=0,m=t,x=-999999999,v=e.subPaths.map((e=>{const r=e.getPoints();let i=-999999999,o=t,s=-999999999,a=t;for(let t=0;t<r.length;t++){const e=r[t];e.y>i&&(i=e.y),e.y<o&&(o=e.y),e.x>s&&(s=e.x),e.x<a&&(a=e.x)}return x<=s&&(x=s+1),m>=a&&(m=a-1),{curves:e.curves,points:r,isCW:n.ShapeUtils.isClockWise(r),identifier:p++,boundingBox:new n.Box2(new n.Vector2(a,o),new n.Vector2(s,i))}}));v=v.filter((e=>e.points.length>1));const y=v.map((t=>function(e,t,r,i,o){null!==o&&void 0!==o&&""!==o||(o="nonzero");const s=new n.Vector2;e.boundingBox.getCenter(s);const a=d([new n.Vector2(r,s.y),new n.Vector2(i,s.y)],e.boundingBox,t);a.sort(((e,t)=>e.point.x-t.point.x));const l=[],u=[];a.forEach((t=>{t.identifier===e.identifier?l.push(t):u.push(t)}));const c=l[0].point.x,h=[];let f=0;for(;f<u.length&&u[f].point.x<c;)h.length>0&&h[h.length-1]===u[f].identifier?h.pop():h.push(u[f].identifier),f++;if(h.push(e.identifier),"evenodd"===o){const t=h.length%2===0,r=h[h.length-2];return{identifier:e.identifier,isHole:t,for:r}}if("nonzero"===o){let r=!0,n=null,i=null;for(let e=0;e<h.length;e++){const o=h[e];r?(i=t[o].isCW,r=!1,n=o):i!==t[o].isCW&&(i=t[o].isCW,r=!0)}return{identifier:e.identifier,isHole:r,for:n}}console.warn('fill-rule: "'+o+'" is currently not implemented.')}(t,v,m,x,e.userData.style.fillRule))),g=[];return v.forEach((e=>{if(!y[e.identifier].isHole){const t=new n.Shape;t.curves=e.curves;y.filter((t=>t.isHole&&t.for===e.identifier)).forEach((e=>{const r=v[e.identifier],i=new n.Path;i.curves=r.curves,t.holes.push(i)})),g.push(t)}})),g}static getStrokeStyle(e,t,r,n,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:i=void 0!==i?i:4}}static pointsToStroke(e,t,r,o){const s=[],a=[],l=[];if(0===i.pointsToStrokeWithBuffers(e,t,r,o,s,a,l))return null;const u=new n.BufferGeometry;return u.setAttribute("position",new n.Float32BufferAttribute(s,3)),u.setAttribute("normal",new n.Float32BufferAttribute(a,3)),u.setAttribute("uv",new n.Float32BufferAttribute(l,2)),u}static pointsToStrokeWithBuffers(e,t,r,i,o,s,a,l){const u=new n.Vector2,c=new n.Vector2,h=new n.Vector2,f=new n.Vector2,d=new n.Vector2,p=new n.Vector2,m=new n.Vector2,x=new n.Vector2,v=new n.Vector2,y=new n.Vector2,g=new n.Vector2,b=new n.Vector2,w=new n.Vector2,M=new n.Vector2,T=new n.Vector2,S=new n.Vector2,_=new n.Vector2;r=void 0!==r?r:12,i=void 0!==i?i:.001,l=void 0!==l?l:0;const D=(e=function(e){let t=!1;for(let n=1,o=e.length-1;n<o;n++)if(e[n].distanceTo(e[n+1])<i){t=!0;break}if(!t)return e;const r=[];r.push(e[0]);for(let n=1,o=e.length-1;n<o;n++)e[n].distanceTo(e[n+1])>=i&&r.push(e[n]);return r.push(e[e.length-1]),r}(e)).length;if(D<2)return 0;const B=e[0].equals(e[D-1]);let A,k,U=e[0];const P=t.strokeWidth/2,C=1/(D-1);let R,E,V,F,I=0,L=!1,N=0,z=3*l,O=2*l;W(e[0],e[1],u).multiplyScalar(P),x.copy(e[0]).sub(u),v.copy(e[0]).add(u),y.copy(x),g.copy(v);for(let n=1;n<D;n++){A=e[n],k=n===D-1?B?e[1]:void 0:e[n+1];const r=u;if(W(U,A,r),h.copy(r).multiplyScalar(P),b.copy(A).sub(h),w.copy(A).add(h),R=I+C,E=!1,void 0!==k){W(A,k,c),h.copy(c).multiplyScalar(P),M.copy(A).sub(h),T.copy(A).add(h),V=!0,h.subVectors(k,U),r.dot(h)<0&&(V=!1),1===n&&(L=V),h.subVectors(k,A),h.normalize();const e=Math.abs(r.dot(h));if(0!==e){const r=P/e;h.multiplyScalar(-r),f.subVectors(A,U),d.copy(f).setLength(r).add(h),S.copy(d).negate();const n=d.length(),i=f.length();f.divideScalar(i),p.subVectors(k,A);const o=p.length();switch(p.divideScalar(o),f.dot(S)<i&&p.dot(S)<o&&(E=!0),_.copy(d).add(A),S.add(A),F=!1,E?V?(T.copy(S),w.copy(S)):(M.copy(S),b.copy(S)):G(),t.strokeLineJoin){case"bevel":H(V,E,R);break;case"round":Z(V,E),V?q(A,b,M,R,0):q(A,T,w,R,1);break;default:const e=P*t.strokeMiterLimit/n;if(e<1){if("miter-clip"!==t.strokeLineJoin){H(V,E,R);break}Z(V,E),V?(p.subVectors(_,b).multiplyScalar(e).add(b),m.subVectors(_,M).multiplyScalar(e).add(M),j(b,R,0),j(p,R,0),j(A,R,.5),j(A,R,.5),j(p,R,0),j(m,R,0),j(A,R,.5),j(m,R,0),j(M,R,0)):(p.subVectors(_,w).multiplyScalar(e).add(w),m.subVectors(_,T).multiplyScalar(e).add(T),j(w,R,1),j(p,R,1),j(A,R,.5),j(A,R,.5),j(p,R,1),j(m,R,1),j(A,R,.5),j(m,R,1),j(T,R,1))}else E?(V?(j(v,I,1),j(x,I,0),j(_,R,0),j(v,I,1),j(_,R,0),j(S,R,1)):(j(v,I,1),j(x,I,0),j(_,R,1),j(x,I,0),j(S,R,0),j(_,R,1)),V?M.copy(_):T.copy(_)):V?(j(b,R,0),j(_,R,0),j(A,R,.5),j(A,R,.5),j(_,R,0),j(M,R,0)):(j(w,R,1),j(_,R,1),j(A,R,.5),j(A,R,.5),j(_,R,1),j(T,R,1)),F=!0}}else G()}else G();B||n!==D-1||J(e[0],y,g,V,!0,I),I=R,U=A,x.copy(M),v.copy(T)}if(B){if(E&&o){let e=_,t=S;L!==V&&(e=S,t=_),V?(F||L)&&(t.toArray(o,0),t.toArray(o,9),F&&e.toArray(o,3)):!F&&L||(t.toArray(o,3),t.toArray(o,9),F&&e.toArray(o,0))}}else J(A,b,w,V,!1,R);return N;function W(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function j(e,t,r){o&&(o[z]=e.x,o[z+1]=e.y,o[z+2]=0,s&&(s[z]=0,s[z+1]=0,s[z+2]=1),z+=3,a&&(a[O]=t,a[O+1]=r,O+=2)),N+=3}function q(e,t,n,i,o){u.copy(t).sub(e).normalize(),c.copy(n).sub(e).normalize();let s=Math.PI;const a=u.dot(c);Math.abs(a)<1&&(s=Math.abs(Math.acos(a))),s/=r,h.copy(t);for(let l=0,u=r-1;l<u;l++)f.copy(h).rotateAround(e,s),j(h,i,o),j(f,i,o),j(e,i,.5),h.copy(f);j(f,i,o),j(n,i,o),j(e,i,.5)}function G(){j(v,I,1),j(x,I,0),j(b,R,0),j(v,I,1),j(b,R,1),j(w,R,0)}function H(e,t,r){t?e?(j(v,I,1),j(x,I,0),j(b,R,0),j(v,I,1),j(b,R,0),j(S,R,1),j(b,r,0),j(M,r,0),j(S,r,.5)):(j(v,I,1),j(x,I,0),j(w,R,1),j(x,I,0),j(S,R,0),j(w,R,1),j(w,r,1),j(T,r,0),j(S,r,.5)):e?(j(b,r,0),j(M,r,0),j(A,r,.5)):(j(w,r,1),j(T,r,0),j(A,r,.5))}function Z(e,t){t&&(e?(j(v,I,1),j(x,I,0),j(b,R,0),j(v,I,1),j(b,R,0),j(S,R,1),j(b,I,0),j(A,R,.5),j(S,R,1),j(A,R,.5),j(M,I,0),j(S,R,1)):(j(v,I,1),j(x,I,0),j(w,R,1),j(x,I,0),j(S,R,0),j(w,R,1),j(w,I,1),j(S,R,0),j(A,R,.5),j(A,R,.5),j(S,R,0),j(T,I,1)))}function J(e,r,n,i,s,a){switch(t.strokeLineCap){case"round":s?q(e,n,r,a,.5):q(e,r,n,a,.5);break;case"square":if(s)u.subVectors(r,e),c.set(u.y,-u.x),h.addVectors(u,c).add(e),f.subVectors(c,u).add(e),i?(h.toArray(o,3),f.toArray(o,0),f.toArray(o,9)):(h.toArray(o,3),h.toArray(o,9),f.toArray(o,0));else{u.subVectors(n,e),c.set(u.y,-u.x),h.addVectors(u,c).add(e),f.subVectors(c,u).add(e);const t=o.length;i?(h.toArray(o,t-3),f.toArray(o,t-6),f.toArray(o,t-12)):(h.toArray(o,t-6),f.toArray(o,t-3),f.toArray(o,t-12))}}}}}}}]);