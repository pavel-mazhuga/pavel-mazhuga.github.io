(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[181],{4644:function(e,t,r){"use strict";r.d(t,{i:function(){return a}});var n=r(7294),o=r(9251);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class s{constructor(e=Math){i(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),i(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),i(this,"p",[]),i(this,"perm",[]),i(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),i(this,"dot",((e,t,r)=>e[0]*t+e[1]*r)),i(this,"dot3",((e,t,r,n)=>e[0]*t+e[1]*r+e[2]*n)),i(this,"dot4",((e,t,r,n,o)=>e[0]*t+e[1]*r+e[2]*n+e[3]*o)),i(this,"noise",((e,t)=>{let r,n,o;const i=(e+t)*(.5*(Math.sqrt(3)-1)),s=Math.floor(e+i),a=Math.floor(t+i),l=(3-Math.sqrt(3))/6,u=(s+a)*l,c=e-(s-u),f=t-(a-u);let h=0,d=1;c>f&&(h=1,d=0);const m=c-h+l,p=f-d+l,y=c-1+2*l,v=f-1+2*l,x=255&s,g=255&a,b=this.perm[x+this.perm[g]]%12,w=this.perm[x+h+this.perm[g+d]]%12,M=this.perm[x+1+this.perm[g+1]]%12;let S=.5-c*c-f*f;S<0?r=0:(S*=S,r=S*S*this.dot(this.grad3[b],c,f));let T=.5-m*m-p*p;T<0?n=0:(T*=T,n=T*T*this.dot(this.grad3[w],m,p));let B=.5-y*y-v*v;return B<0?o=0:(B*=B,o=B*B*this.dot(this.grad3[M],y,v)),70*(r+n+o)})),i(this,"noise3d",((e,t,r)=>{let n,o,i,s;const a=(e+t+r)*(1/3),l=Math.floor(e+a),u=Math.floor(t+a),c=Math.floor(r+a),f=1/6,h=(l+u+c)*f,d=e-(l-h),m=t-(u-h),p=r-(c-h);let y,v,x,g,b,w;d>=m?m>=p?(y=1,v=0,x=0,g=1,b=1,w=0):d>=p?(y=1,v=0,x=0,g=1,b=0,w=1):(y=0,v=0,x=1,g=1,b=0,w=1):m<p?(y=0,v=0,x=1,g=0,b=1,w=1):d<p?(y=0,v=1,x=0,g=0,b=1,w=1):(y=0,v=1,x=0,g=1,b=1,w=0);const M=d-y+f,S=m-v+f,T=p-x+f,B=d-g+2*f,A=m-b+2*f,D=p-w+2*f,_=d-1+.5,E=m-1+.5,C=p-1+.5,R=255&l,k=255&u,P=255&c,U=this.perm[R+this.perm[k+this.perm[P]]]%12,V=this.perm[R+y+this.perm[k+v+this.perm[P+x]]]%12,L=this.perm[R+g+this.perm[k+b+this.perm[P+w]]]%12,F=this.perm[R+1+this.perm[k+1+this.perm[P+1]]]%12;let I=.6-d*d-m*m-p*p;I<0?n=0:(I*=I,n=I*I*this.dot3(this.grad3[U],d,m,p));let O=.6-M*M-S*S-T*T;O<0?o=0:(O*=O,o=O*O*this.dot3(this.grad3[V],M,S,T));let z=.6-B*B-A*A-D*D;z<0?i=0:(z*=z,i=z*z*this.dot3(this.grad3[L],B,A,D));let j=.6-_*_-E*E-C*C;return j<0?s=0:(j*=j,s=j*j*this.dot3(this.grad3[F],_,E,C)),32*(n+o+i+s)})),i(this,"noise4d",((e,t,r,n)=>{const o=this.grad4,i=this.simplex,s=this.perm,a=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let u,c,f,h,d;const m=(e+t+r+n)*a,p=Math.floor(e+m),y=Math.floor(t+m),v=Math.floor(r+m),x=Math.floor(n+m),g=(p+y+v+x)*l,b=e-(p-g),w=t-(y-g),M=r-(v-g),S=n-(x-g),T=(b>w?32:0)+(b>M?16:0)+(w>M?8:0)+(b>S?4:0)+(w>S?2:0)+(M>S?1:0);let B,A,D,_,E,C,R,k,P,U,V,L;B=i[T][0]>=3?1:0,A=i[T][1]>=3?1:0,D=i[T][2]>=3?1:0,_=i[T][3]>=3?1:0,E=i[T][0]>=2?1:0,C=i[T][1]>=2?1:0,R=i[T][2]>=2?1:0,k=i[T][3]>=2?1:0,P=i[T][0]>=1?1:0,U=i[T][1]>=1?1:0,V=i[T][2]>=1?1:0,L=i[T][3]>=1?1:0;const F=b-B+l,I=w-A+l,O=M-D+l,z=S-_+l,j=b-E+2*l,N=w-C+2*l,G=M-R+2*l,W=S-k+2*l,q=b-P+3*l,H=w-U+3*l,Y=M-V+3*l,Q=S-L+3*l,J=b-1+4*l,K=w-1+4*l,X=M-1+4*l,Z=S-1+4*l,$=255&p,ee=255&y,te=255&v,re=255&x,ne=s[$+s[ee+s[te+s[re]]]]%32,oe=s[$+B+s[ee+A+s[te+D+s[re+_]]]]%32,ie=s[$+E+s[ee+C+s[te+R+s[re+k]]]]%32,se=s[$+P+s[ee+U+s[te+V+s[re+L]]]]%32,ae=s[$+1+s[ee+1+s[te+1+s[re+1]]]]%32;let le=.6-b*b-w*w-M*M-S*S;le<0?u=0:(le*=le,u=le*le*this.dot4(o[ne],b,w,M,S));let ue=.6-F*F-I*I-O*O-z*z;ue<0?c=0:(ue*=ue,c=ue*ue*this.dot4(o[oe],F,I,O,z));let ce=.6-j*j-N*N-G*G-W*W;ce<0?f=0:(ce*=ce,f=ce*ce*this.dot4(o[ie],j,N,G,W));let fe=.6-q*q-H*H-Y*Y-Q*Q;fe<0?h=0:(fe*=fe,h=fe*fe*this.dot4(o[se],q,H,Y,Q));let he=.6-J*J-K*K-X*X-Z*Z;return he<0?d=0:(he*=he,d=he*he*this.dot4(o[ae],J,K,X,Z)),27*(u+c+f+h+d)}));for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let t=0;t<512;t++)this.perm[t]=this.p[255&t]}}const a=n.forwardRef((({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:i=.1,maxPitch:a=.1,maxRoll:l=.1,yawFrequency:u=.1,pitchFrequency:c=.1,rollFrequency:f=.1,controls:h},d)=>{const m=(0,o.Ky)((e=>e.camera)),p=(0,o.Ky)((e=>e.controls)),y=n.useRef(e),v=n.useRef(m.rotation.clone()),[x]=n.useState((()=>new s)),[g]=n.useState((()=>new s)),[b]=n.useState((()=>new s)),w=()=>{(y.current<0||y.current>1)&&(y.current=y.current<0?0:1)};return n.useImperativeHandle(d,(()=>({getIntensity:()=>y.current,setIntensity:e=>{y.current=e,w()}})),[]),n.useEffect((()=>{const e=p||(null==h?void 0:h.current),t=()=>{v.current=m.rotation.clone()};return null==e||e.addEventListener("change",t),()=>{null==e||e.removeEventListener("change",t)}}),[h,p]),(0,o.xQ)((({clock:e},n)=>{const o=Math.pow(y.current,2),s=i*o*x.noise(e.elapsedTime*u,1),h=a*o*g.noise(e.elapsedTime*c,1),d=l*o*b.noise(e.elapsedTime*f,1);m.rotation.set(v.current.x+h,v.current.y+s,v.current.z+d),t&&y.current>0&&(y.current-=r*n,w())})),null}))},3218:function(e,t,r){"use strict";r.d(t,{r:function(){return f}});var n=r(7462),o=r(7294),i=r(2212),s=r(9251),a=r(5878);class l extends i.ShaderMaterial{constructor(e=new i.Vector2){super({uniforms:{inputBuffer:new i.Uniform(null),depthBuffer:new i.Uniform(null),resolution:new i.Uniform(new i.Vector2),texelSize:new i.Uniform(new i.Vector2),halfTexelSize:new i.Uniform(new i.Vector2),kernel:new i.Uniform(0),scale:new i.Uniform(1),cameraNear:new i.Uniform(0),cameraFar:new i.Uniform(1),minDepthThreshold:new i.Uniform(0),maxDepthThreshold:new i.Uniform(1),depthScale:new i.Uniform(0),depthToBlurRatioBias:new i.Uniform(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n        }",vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:i.NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class u{constructor({gl:e,resolution:t,width:r=500,height:n=500,minDepthThreshold:o=0,maxDepthThreshold:s=1,depthScale:a=0,depthToBlurRatioBias:u=.25}){this.renderToScreen=!1,this.renderTargetA=new i.WebGLRenderTarget(t,t,{minFilter:i.LinearFilter,magFilter:i.LinearFilter,stencilBuffer:!1,depthBuffer:!1,encoding:e.outputEncoding}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new l,this.convolutionMaterial.setTexelSize(1/r,1/n),this.convolutionMaterial.setResolution(new i.Vector2(r,n)),this.scene=new i.Scene,this.camera=new i.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=o,this.convolutionMaterial.uniforms.maxDepthThreshold.value=s,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=u,this.convolutionMaterial.defines.USE_DEPTH=a>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),f=new Float32Array([0,0,2,0,0,2]),h=new i.BufferGeometry;h.setAttribute("position",new i.BufferAttribute(c,3)),h.setAttribute("uv",new i.BufferAttribute(f,2)),this.screen=new i.Mesh(h,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,r){const n=this.scene,o=this.camera,i=this.renderTargetA,s=this.renderTargetB;let a=this.convolutionMaterial,l=a.uniforms;l.depthBuffer.value=t.depthTexture;const u=a.kernel;let c,f,h,d=t;for(f=0,h=u.length-1;f<h;++f)c=0===(1&f)?i:s,l.kernel.value=u[f],l.inputBuffer.value=d.texture,e.setRenderTarget(c),e.render(n,o),d=c;l.kernel.value=u[f],l.inputBuffer.value=d.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(n,o)}}class c extends i.MeshStandardMaterial{constructor(e={}){super(e),this._debug={value:0},this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.debug=this._debug,e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;     \n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform int debug;\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;        \n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n    \n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n      \n      vec4 merge = base;\n      \n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n  \n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n      \n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);           \n      diffuseColor = sRGBToLinear(diffuseColor);\n      \n      if (debug == 1) {\n        diffuseColor = sRGBToLinear(vec4(vec3(depthFactor), 1.0));\n      }\n      if (debug == 2) {\n        diffuseColor = sRGBToLinear(vec4(vec3(blurFactor), 1.0));\n      }\n      if (debug == 3) {\n        diffuseColor = sRGBToLinear(texture2DProj(tDiffuse, new_vUv));\n      }\n      if (debug == 4) {\n        diffuseColor = sRGBToLinear(texture2DProj(tDiffuseBlur, new_vUv));\n      }\n      ")}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get debug(){return this._debug.value}set debug(e){this._debug.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}(0,s.l7)({MeshReflectorMaterial:c});const f=o.forwardRef((({mixBlur:e=0,mixStrength:t=.5,resolution:r=256,blur:l=[0,0],args:c=[1,1],minDepthThreshold:f=.9,maxDepthThreshold:h=1,depthScale:d=0,depthToBlurRatioBias:m=.25,mirror:p=0,children:y,debug:v=0,distortion:x=1,mixContrast:g=1,distortionMap:b,...w},M)=>{o.useEffect((()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")}),[]);const S=(0,s.Ky)((({gl:e})=>e)),T=(0,s.Ky)((({camera:e})=>e)),B=(0,s.Ky)((({scene:e})=>e)),A=(l=Array.isArray(l)?l:[l,l])[0]+l[1]>0,D=o.useRef(null),[_]=o.useState((()=>new i.Plane)),[E]=o.useState((()=>new i.Vector3)),[C]=o.useState((()=>new i.Vector3)),[R]=o.useState((()=>new i.Vector3)),[k]=o.useState((()=>new i.Matrix4)),[P]=o.useState((()=>new i.Vector3(0,0,-1))),[U]=o.useState((()=>new i.Vector4)),[V]=o.useState((()=>new i.Vector3)),[L]=o.useState((()=>new i.Vector3)),[F]=o.useState((()=>new i.Vector4)),[I]=o.useState((()=>new i.Matrix4)),[O]=o.useState((()=>new i.PerspectiveCamera)),z=o.useCallback((()=>{if(C.setFromMatrixPosition(D.current.matrixWorld),R.setFromMatrixPosition(T.matrixWorld),k.extractRotation(D.current.matrixWorld),E.set(0,0,1),E.applyMatrix4(k),V.subVectors(C,R),V.dot(E)>0)return;V.reflect(E).negate(),V.add(C),k.extractRotation(T.matrixWorld),P.set(0,0,-1),P.applyMatrix4(k),P.add(R),L.subVectors(C,P),L.reflect(E).negate(),L.add(C),O.position.copy(V),O.up.set(0,1,0),O.up.applyMatrix4(k),O.up.reflect(E),O.lookAt(L),O.far=T.far,O.updateMatrixWorld(),O.projectionMatrix.copy(T.projectionMatrix),I.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),I.multiply(O.projectionMatrix),I.multiply(O.matrixWorldInverse),I.multiply(D.current.matrixWorld),_.setFromNormalAndCoplanarPoint(E,C),_.applyMatrix4(O.matrixWorldInverse),U.set(_.normal.x,_.normal.y,_.normal.z,_.constant);const e=O.projectionMatrix;F.x=(Math.sign(U.x)+e.elements[8])/e.elements[0],F.y=(Math.sign(U.y)+e.elements[9])/e.elements[5],F.z=-1,F.w=(1+e.elements[10])/e.elements[14],U.multiplyScalar(2/U.dot(F)),e.elements[2]=U.x,e.elements[6]=U.y,e.elements[10]=U.z+1,e.elements[14]=U.w}),[]),[j,N,G,W]=o.useMemo((()=>{const n={minFilter:i.LinearFilter,magFilter:i.LinearFilter,encoding:S.outputEncoding},o=new i.WebGLRenderTarget(r,r,n);o.depthBuffer=!0,o.depthTexture=new i.DepthTexture(r,r),o.depthTexture.format=i.DepthFormat,o.depthTexture.type=i.UnsignedShortType;const s=new i.WebGLRenderTarget(r,r,n);return[o,s,new u({gl:S,resolution:r,width:l[0],height:l[1],minDepthThreshold:f,maxDepthThreshold:h,depthScale:d,depthToBlurRatioBias:m}),{mirror:p,textureMatrix:I,mixBlur:e,tDiffuse:o.texture,tDepth:o.depthTexture,tDiffuseBlur:s.texture,hasBlur:A,mixStrength:t,minDepthThreshold:f,maxDepthThreshold:h,depthScale:d,depthToBlurRatioBias:m,transparent:!0,debug:v,distortion:x,distortionMap:b,mixContrast:g,"defines-USE_BLUR":A?"":void 0,"defines-USE_DEPTH":d>0?"":void 0,"defines-USE_DISTORTION":b?"":void 0}]}),[S,l,I,r,p,A,e,t,f,h,d,m,v,x,b,g]);return(0,s.xQ)((()=>{if(null==D||!D.current)return;D.current.visible=!1;const e=S.xr.enabled,t=S.shadowMap.autoUpdate;z(),S.xr.enabled=!1,S.shadowMap.autoUpdate=!1,S.setRenderTarget(j),S.state.buffers.depth.setMask(!0),S.autoClear||S.clear(),S.render(B,O),A&&G.render(S,j,N),S.xr.enabled=e,S.shadowMap.autoUpdate=t,D.current.visible=!0,S.setRenderTarget(null)})),o.createElement("mesh",(0,n.Z)({ref:(0,a.Z)([D,M])},w),o.createElement("planeBufferGeometry",{args:c}),y?y("meshReflectorMaterial",W):o.createElement("meshReflectorMaterial",W))}))},1033:function(e,t,r){"use strict";r.d(t,{j:function(){return l}});var n=r(7294),o=r(9251),i=r(3466),s=r.n(i);function a(e,t){"function"===typeof e?e(t):null!=e&&(e.current=t)}function l({showPanel:e=0,className:t,parent:r}){const i=function(e,t=[],r){const[o,i]=n.useState();return n.useLayoutEffect((()=>{const t=e();return i(t),a(r,t),()=>a(r,null)}),t),o}((()=>new(s())),[]);return n.useEffect((()=>{if(i){const n=r&&r.current||document.body;i.showPanel(e),null==n||n.appendChild(i.dom),t&&i.dom.classList.add(t);const s=(0,o.gy)((()=>i.begin())),a=(0,o.Lr)((()=>i.end()));return()=>{null==n||n.removeChild(i.dom),s(),a()}}}),[r,i,t,e]),null}},5769:function(e,t,r){"use strict";r.d(t,{m:function(){return a}});var n=r(2212),o=r(9251),i=r(7294);const s=e=>e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e;function a(e){const t=(0,o.Ky)((e=>e.gl)),r=(0,o.U2)(n.TextureLoader,s(e)?Object.values(e):e);if((0,i.useEffect)((()=>{(Array.isArray(r)?r:[r]).forEach(t.initTexture)}),[t,r]),s(e)){const t=Object.keys(e),n={};return t.forEach((e=>Object.assign(n,{[e]:r[t.indexOf(e)]}))),n}return r}a.preload=e=>o.U2.preload(n.TextureLoader,e),a.clear=e=>o.U2.clear(n.TextureLoader,e)},3277:function(e,t,r){"use strict";r.d(t,{xC:function(){return f},k:function(){return h}});var n=r(2248),o=r(7294),i=r(2212),s=r(9251);const a=(e,t=n.YQ.NORMAL)=>(0,o.forwardRef)((function({blendFunction:r,opacity:n,...i},s){const a=(0,o.useMemo)((()=>new e(i)),[i]);return(0,o.useLayoutEffect)((()=>{a.blendMode.blendFunction=r||t,void 0!==n&&(a.blendMode.opacity.value=n)}),[r,a.blendMode,n]),o.createElement("primitive",{ref:s,object:a,dispose:null})})),l=(e,t)=>{const r=e[t];return(0,o.useMemo)((()=>{if(r instanceof i.Vector2)return(new i.Vector2).set(r.x,r.y);if(Array.isArray(r)){const[e,t]=r;return(new i.Vector2).set(e,t)}}),[r])},u=()=>{try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},c=(a(n.rk,n.YQ.SCREEN),a(n.at),(0,o.forwardRef)((function(e,t){const r=l(e,"offset"),i=(0,o.useMemo)((()=>new n.YY({...e,offset:r})),[r,e]);return o.createElement("primitive",{ref:t,object:i,dispose:null})})),(0,o.forwardRef)((function({blendFunction:e=n.YQ.NORMAL},t){const r=(0,o.useMemo)((()=>new n.TC(e)),[e]);return o.createElement("primitive",{ref:t,object:r,dispose:null})})),a(n.zo),a(n.AL),(0,o.createContext)(null)),f=o.memo((0,o.forwardRef)((({children:e,camera:t,scene:r,renderPriority:i=1,autoClear:a=!0,depthBuffer:l,disableNormalPass:f,stencilBuffer:h,multisampling:d=8,frameBufferType:m},p)=>{const{gl:y,scene:v,camera:x,size:g}=(0,s.Ky)();r=r||v,t=t||x;const[b,w]=(0,o.useMemo)((()=>{const e=new n.xC(y,{depthBuffer:l,stencilBuffer:h,multisampling:u()?d:0,frameBufferType:m});e.addPass(new n.CD(r,t));const o=f?null:new n.gh(r,t);return o&&e.addPass(o),[e,o]}),[t,y,l,h,d,m,r,f]);(0,o.useEffect)((()=>null==b?void 0:b.setSize(g.width,g.height)),[b,g]),(0,s.xQ)(((e,t)=>(y.autoClear=a,void b.render(t))),i);const M=(0,o.useRef)(null);(0,o.useEffect)((()=>{let e;return M.current&&M.current.__r3f&&b&&(e=new n.H5(t,...M.current.__r3f.objects),b.addPass(e),e.renderToScreen=!0),()=>{e&&(null==b||b.removePass(e))}}),[b,e,t]);const S=(0,o.useMemo)((()=>({composer:b,normalPass:w,camera:t,scene:r})),[b,w,t,r]);return(0,o.useImperativeHandle)(p,(()=>b),[b]),o.createElement(c.Provider,{value:S},o.createElement("group",{ref:M},e))}))),h=((0,o.forwardRef)((function({target:e,depthTexture:t,...r},s){const{camera:a}=(0,o.useContext)(c),l=(0,o.useMemo)((()=>new n.Jy(a,r)),[a,r]);return(0,o.useLayoutEffect)((()=>{if(e){const t=e instanceof i.Vector3?(new i.Vector3).set(e.x,e.y,e.z):(new i.Vector3).set(e[0],e[1],e[2]);l.target=t}t&&l.setDepthTexture(t.texture,t.packing)}),[e,t,l]),o.createElement("primitive",{ref:s,object:l,dispose:null})})),a(n.ol),(0,o.forwardRef)((function({active:e=!0,...t},r){const i=l(t,"delay"),s=l(t,"duration"),a=l(t,"strength"),u=(0,o.useMemo)((()=>new n.sy({...t,delay:i,duration:s,strength:a})),[i,s,t,a]);return(0,o.useLayoutEffect)((()=>{u.mode=e?t.mode||n.O7.SPORADIC:n.O7.DISABLED}),[e,u,t.mode]),o.createElement("primitive",{ref:r,object:u,dispose:null})})),(0,o.forwardRef)((function(e,t){const{camera:r}=(0,o.useContext)(c),i=(0,o.useMemo)((()=>new n.KI(r,e.sun,e)),[r,e]);return o.createElement("primitive",{ref:t,object:i,dispose:null})})),(0,o.forwardRef)((function({size:e,...t},r){const i=(0,o.useMemo)((()=>new n.Qt(t)),[t]);return(0,o.useLayoutEffect)((()=>{e&&i.setSize(e.width,e.height)}),[i,e]),o.createElement("primitive",{ref:r,object:i,dispose:null})})),a(n.JL),a(n.xV,n.YQ.COLOR_DODGE),(0,o.forwardRef)((function({selection:e=[],selectionLayer:t=10,blendFunction:r,patternTexture:i,edgeStrength:s,pulseSpeed:a,visibleEdgeColor:l,hiddenEdgeColor:u,width:f,height:h,kernelSize:d,blur:m,xRay:p,...y},v){const{scene:x,camera:g}=(0,o.useContext)(c),b=(0,o.useMemo)((()=>new n.Mn(x,g,{blendFunction:r,patternTexture:i,edgeStrength:s,pulseSpeed:a,visibleEdgeColor:l,hiddenEdgeColor:u,width:f,height:h,kernelSize:d,blur:m,xRay:p})),[r,m,g,s,h,u,d,i,a,x,l,f,p]);return(0,o.useEffect)((()=>{b.clearSelection(),b.setSelection(Array.isArray(e)?e.map((e=>e.current)):[e.current])}),[b,e]),(0,o.useEffect)((()=>{b.selectionLayer=t}),[b,t]),o.createElement("primitive",{ref:v,object:b,dispose:null})})),(0,o.forwardRef)((function({granularity:e=5},t){const r=(0,o.useMemo)((()=>new n.Qg(e)),[e]);return o.createElement("primitive",{ref:t,object:r,dispose:null})})),a(n.p$,n.YQ.OVERLAY),(0,o.forwardRef)((function({selection:e=[],selectionLayer:t=10,lights:r=[],luminanceThreshold:i,luminanceSmoothing:s,intensity:a,width:l,height:u,kernelSize:f},h){0===r.length&&console.warn("SelectiveBloom requires lights to work.");const{scene:d,camera:m}=(0,o.useContext)(c),p=(0,o.useMemo)((()=>new n.V$(d,m,{blendFunction:n.YQ.SCREEN,luminanceThreshold:i,luminanceSmoothing:s,intensity:a,width:l,height:u,kernelSize:f})),[m,u,a,f,s,i,d,l]);return(0,o.useEffect)((()=>{p.selection.set(Array.isArray(e)?e.map((e=>e.current)):[e.current])}),[p,e]),(0,o.useEffect)((()=>{p.selection.layer=t}),[p,t]),(0,o.useEffect)((()=>(r.forEach((e=>((e,t)=>{e.current&&e.current.layers.enable(t.selection.layer)})(e,p))),()=>r.forEach((e=>((e,t)=>{e.current&&e.current.layers.disable(t.selection.layer)})(e,p))))),[p,r,t]),o.createElement("primitive",{ref:h,object:p,dispose:null})})),a(n.wL),(0,o.forwardRef)((function(e,t){const{camera:r,normalPass:i}=(0,o.useContext)(c),s=(0,o.useMemo)((()=>null===i?(console.error("Please enable the NormalPass in the EffectComposer in order to use SSAO."),null):new n.bn(r,i.renderTarget.texture,{blendFunction:n.YQ.MULTIPLY,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,scale:.5,bias:.5,...e})),[r,i,e]);return o.createElement("primitive",{ref:t,object:s,dispose:null})})),(0,o.forwardRef)((function({preset:e=n.F9.HIGH,edgeDetectionMode:t=n.HN.COLOR},r){const i=(0,s.U2)(n.hB,""),a=(0,o.useMemo)((()=>new n.fY(...i,e,t)),[i,e,t]);return o.createElement("primitive",{ref:r,object:a,dispose:null})})));(0,o.forwardRef)((function({textureSrc:e,texture:t,...r},a){const l=(0,s.U2)(i.TextureLoader,e);(0,o.useLayoutEffect)((()=>{l.encoding=i.sRGBEncoding,l.wrapS=l.wrapT=i.RepeatWrapping}),[l]);const u=(0,o.useMemo)((()=>new n.tq({...r,texture:l||t})),[r,l,t]);return o.createElement("primitive",{ref:a,object:u,dispose:null})})),a(n.M4),a(n.Dd),a(n.Uy),(0,o.forwardRef)((function({lut:e,tetrahedralInterpolation:t,...r},i){const s=(0,o.useMemo)((()=>new n.YH(e,r)),[e,r]);return(0,o.useLayoutEffect)((()=>{e&&s.setLUT(e),t&&s.setTetrahedralInterpolationEnabled(t)}),[s,e,t]),o.createElement("primitive",{ref:i,object:s,dispose:null})}))},3466:function(e){e.exports=function(){var e=function(){function t(e){return o.appendChild(e.dom),e}function r(e){for(var t=0;t<o.children.length;t++)o.children[t].style.display=t===e?"block":"none";n=e}var n=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",(function(e){e.preventDefault(),r(++n%o.children.length)}),!1);var i=(performance||Date).now(),s=i,a=0,l=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:o,addPanel:t,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(u.update(e-i,200),e>s+1e3&&(l.update(1e3*a/(e-s),100),s=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:o,setMode:r}};return e.Panel=function(e,t,r){var n=1/0,o=0,i=Math.round,s=i(window.devicePixelRatio||1),a=80*s,l=48*s,u=3*s,c=2*s,f=3*s,h=15*s,d=74*s,m=30*s,p=document.createElement("canvas");p.width=a,p.height=l,p.style.cssText="width:80px;height:48px";var y=p.getContext("2d");return y.font="bold "+9*s+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=r,y.fillRect(0,0,a,l),y.fillStyle=t,y.fillText(e,u,c),y.fillRect(f,h,d,m),y.fillStyle=r,y.globalAlpha=.9,y.fillRect(f,h,d,m),{dom:p,update:function(l,v){n=Math.min(n,l),o=Math.max(o,l),y.fillStyle=r,y.globalAlpha=1,y.fillRect(0,0,a,h),y.fillStyle=t,y.fillText(i(l)+" "+e+" ("+i(n)+"-"+i(o)+")",u,c),y.drawImage(p,f+s,h,d-s,m,f,h,d-s,m),y.fillRect(f+d-s,h,s,m),y.fillStyle=r,y.globalAlpha=.9,y.fillRect(f+d-s,h,s,i((1-l/v)*m))}}},e}()},7462:function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r.d(t,{Z:function(){return n}})},4730:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}r.d(t,{Z:function(){return n}})},2640:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(l){a=!0,o=l}finally{try{s||null==r.return||r.return()}finally{if(a)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"===typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.d(t,{Z:function(){return o}})},1367:function(e,t,r){"use strict";r.d(t,{u:function(){return o}});var n=r(2212);class o extends n.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,r,o){const i=this,s=new n.FileLoader(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(r){try{t(i.parse(r))}catch(n){o?o(n):console.error(n),i.manager.itemError(e)}}),r,o)}parse(e){const t=this;function r(e,t,r,n,i,s,a,l){if(0==t||0==r)return void e.lineTo(l.x,l.y);n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);const u=(a.x-l.x)/2,c=(a.y-l.y)/2,f=Math.cos(n)*u+Math.sin(n)*c,h=-Math.sin(n)*u+Math.cos(n)*c;let d=t*t,m=r*r;const p=f*f,y=h*h,v=p/d+y/m;if(v>1){const e=Math.sqrt(v);d=(t*=e)*t,m=(r*=e)*r}const x=d*y+m*p,g=(d*m-x)/x;let b=Math.sqrt(Math.max(0,g));i===s&&(b=-b);const w=b*t*h/r,M=-b*r*f/t,S=Math.cos(n)*w-Math.sin(n)*M+(a.x+l.x)/2,T=Math.sin(n)*w+Math.cos(n)*M+(a.y+l.y)/2,B=o(1,0,(f-w)/t,(h-M)/r),A=o((f-w)/t,(h-M)/r,(-f-w)/t,(-h-M)/r)%(2*Math.PI);e.currentPath.absellipse(S,T,t,r,B,B+A,0===s,n)}function o(e,t,r,n){const o=e*r+t*n,i=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n);let s=Math.acos(Math.max(-1,Math.min(1,o/i)));return e*n-t*r<0&&(s=-s),s}function i(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)r=Object.assign(r,m["."+t[e]])}function n(n,o,i){void 0===i&&(i=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(n)&&(t[o]=i(e.getAttribute(n))),r[n]&&(t[o]=i(r[n])),e.style&&""!==e.style[n]&&(t[o]=i(e.style[n]))}function o(e){return Math.max(0,Math.min(1,c(e)))}function i(e){return Math.max(0,c(e))}return e.hasAttribute("id")&&(r=Object.assign(r,m["#"+e.getAttribute("id")])),n("fill","fill"),n("fill-opacity","fillOpacity",o),n("fill-rule","fillRule"),n("opacity","opacity",o),n("stroke","stroke"),n("stroke-opacity","strokeOpacity",o),n("stroke-width","strokeWidth",i),n("stroke-linejoin","strokeLineJoin"),n("stroke-linecap","strokeLineCap"),n("stroke-miterlimit","strokeMiterLimit",i),n("visibility","visibility"),t}function s(e,t){return e-(t-e)}function a(e,t,r){if("string"!==typeof e)throw new TypeError("Invalid input: "+typeof e);const n={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let o=0,i=!0,s="",a="";const l=[];function u(e,t,r){const n=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw n.partial=r,n}function c(){""!==s&&(""===a?l.push(Number(s)):l.push(Number(s)*Math.pow(10,Number(a)))),s="",a=""}let f;const h=e.length;for(let d=0;d<h;d++)if(f=e[d],Array.isArray(t)&&t.includes(l.length%r)&&n.FLAGS.test(f))o=1,s=f,c();else{if(0===o){if(n.WHITESPACE.test(f))continue;if(n.DIGIT.test(f)||n.SIGN.test(f)){o=1,s=f;continue}if(n.POINT.test(f)){o=2,s=f;continue}n.COMMA.test(f)&&(i&&u(f,d,l),i=!0)}if(1===o){if(n.DIGIT.test(f)){s+=f;continue}if(n.POINT.test(f)){s+=f,o=2;continue}if(n.EXP.test(f)){o=3;continue}n.SIGN.test(f)&&1===s.length&&n.SIGN.test(s[0])&&u(f,d,l)}if(2===o){if(n.DIGIT.test(f)){s+=f;continue}if(n.EXP.test(f)){o=3;continue}n.POINT.test(f)&&"."===s[s.length-1]&&u(f,d,l)}if(3===o){if(n.DIGIT.test(f)){a+=f;continue}if(n.SIGN.test(f)){if(""===a){a+=f;continue}1===a.length&&n.SIGN.test(a)&&u(f,d,l)}}n.WHITESPACE.test(f)?(c(),o=0,i=!1):n.COMMA.test(f)?(c(),o=0,i=!0):n.SIGN.test(f)?(c(),o=1,s=f):n.POINT.test(f)?(c(),o=2,s=f):u(f,d,l)}return c(),l}const l=["mm","cm","in","pt","pc","px"],u={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(e){let r,n="px";if("string"===typeof e||e instanceof String)for(let t=0,o=l.length;t<o;t++){const r=l[t];if(e.endsWith(r)){n=r,e=e.substring(0,e.length-r.length);break}}return"px"===n&&"px"!==t.defaultUnit?r=u.in[t.defaultUnit]/t.defaultDPI:(r=u[n][t.defaultUnit],r<0&&(r=u[n].in*t.defaultDPI)),r*parseFloat(e)}function f(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const d=[],m={},p=[],y=new n.Matrix3,v=new n.Matrix3,x=new n.Matrix3,g=new n.Matrix3,b=new n.Vector2,w=new n.Vector3,M=new n.Matrix3,S=(new DOMParser).parseFromString(e,"image/svg+xml");!function e(t,o){if(1!==t.nodeType)return;const l=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;const t=function(e){const t=new n.Matrix3,r=y;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){const r=c(e.getAttribute("x")),n=c(e.getAttribute("y"));t.translate(r,n)}if(e.hasAttribute("transform")){const n=e.getAttribute("transform").split(")");for(let e=n.length-1;e>=0;e--){const o=n[e].trim();if(""===o)continue;const i=o.indexOf("("),s=o.length;if(i>0&&i<s){const e=o.substr(0,i),t=a(o.substr(i+1,s-i-1));switch(r.identity(),e){case"translate":if(t.length>=1){const e=t[0];let n=e;t.length>=2&&(n=t[1]),r.translate(e,n)}break;case"rotate":if(t.length>=1){let e=0,n=0,o=0;e=-t[0]*Math.PI/180,t.length>=3&&(n=t[1],o=t[2]),v.identity().translate(-n,-o),x.identity().rotate(e),g.multiplyMatrices(x,v),v.identity().translate(n,o),r.multiplyMatrices(v,g)}break;case"scale":if(t.length>=1){const e=t[0];let n=e;t.length>=2&&(n=t[1]),r.scale(e,n)}break;case"skewX":1===t.length&&r.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&r.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&r.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(r)}}return t}(e);p.length>0&&t.premultiply(p[p.length-1]);return M.copy(t),p.push(t),t}(t);let u=!0,S=null;switch(t.nodeName){case"svg":break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const r=e.sheet.cssRules[t];if(1!==r.type)continue;const n=r.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<n.length;e++)m[n[e]]=Object.assign(m[n[e]]||{},r.style)}}(t);break;case"g":o=i(t,o);break;case"path":o=i(t,o),t.hasAttribute("d")&&(S=function(e){const t=new n.ShapePath,o=new n.Vector2,i=new n.Vector2,l=new n.Vector2;let u=!0,c=!1;const f=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let n=0,h=f.length;n<h;n++){const e=f[n],h=e.charAt(0),d=e.substr(1).trim();let m;switch(!0===u&&(c=!0,u=!1),h){case"M":m=a(d);for(let e=0,r=m.length;e<r;e+=2)o.x=m[e+0],o.y=m[e+1],i.x=o.x,i.y=o.y,0===e?t.moveTo(o.x,o.y):t.lineTo(o.x,o.y),0===e&&!0===c&&l.copy(o);break;case"H":m=a(d);for(let e=0,r=m.length;e<r;e++)o.x=m[e],i.x=o.x,i.y=o.y,t.lineTo(o.x,o.y),0===e&&!0===c&&l.copy(o);break;case"V":m=a(d);for(let e=0,r=m.length;e<r;e++)o.y=m[e],i.x=o.x,i.y=o.y,t.lineTo(o.x,o.y),0===e&&!0===c&&l.copy(o);break;case"L":m=a(d);for(let e=0,r=m.length;e<r;e+=2)o.x=m[e+0],o.y=m[e+1],i.x=o.x,i.y=o.y,t.lineTo(o.x,o.y),0===e&&!0===c&&l.copy(o);break;case"C":m=a(d);for(let e=0,r=m.length;e<r;e+=6)t.bezierCurveTo(m[e+0],m[e+1],m[e+2],m[e+3],m[e+4],m[e+5]),i.x=m[e+2],i.y=m[e+3],o.x=m[e+4],o.y=m[e+5],0===e&&!0===c&&l.copy(o);break;case"S":m=a(d);for(let e=0,r=m.length;e<r;e+=4)t.bezierCurveTo(s(o.x,i.x),s(o.y,i.y),m[e+0],m[e+1],m[e+2],m[e+3]),i.x=m[e+0],i.y=m[e+1],o.x=m[e+2],o.y=m[e+3],0===e&&!0===c&&l.copy(o);break;case"Q":m=a(d);for(let e=0,r=m.length;e<r;e+=4)t.quadraticCurveTo(m[e+0],m[e+1],m[e+2],m[e+3]),i.x=m[e+0],i.y=m[e+1],o.x=m[e+2],o.y=m[e+3],0===e&&!0===c&&l.copy(o);break;case"T":m=a(d);for(let e=0,r=m.length;e<r;e+=2){const r=s(o.x,i.x),n=s(o.y,i.y);t.quadraticCurveTo(r,n,m[e+0],m[e+1]),i.x=r,i.y=n,o.x=m[e+0],o.y=m[e+1],0===e&&!0===c&&l.copy(o)}break;case"A":m=a(d,[3,4],7);for(let e=0,n=m.length;e<n;e+=7){if(m[e+5]==o.x&&m[e+6]==o.y)continue;const n=o.clone();o.x=m[e+5],o.y=m[e+6],i.x=o.x,i.y=o.y,r(t,m[e],m[e+1],m[e+2],m[e+3],m[e+4],n,o),0===e&&!0===c&&l.copy(o)}break;case"m":m=a(d);for(let e=0,r=m.length;e<r;e+=2)o.x+=m[e+0],o.y+=m[e+1],i.x=o.x,i.y=o.y,0===e?t.moveTo(o.x,o.y):t.lineTo(o.x,o.y),0===e&&!0===c&&l.copy(o);break;case"h":m=a(d);for(let e=0,r=m.length;e<r;e++)o.x+=m[e],i.x=o.x,i.y=o.y,t.lineTo(o.x,o.y),0===e&&!0===c&&l.copy(o);break;case"v":m=a(d);for(let e=0,r=m.length;e<r;e++)o.y+=m[e],i.x=o.x,i.y=o.y,t.lineTo(o.x,o.y),0===e&&!0===c&&l.copy(o);break;case"l":m=a(d);for(let e=0,r=m.length;e<r;e+=2)o.x+=m[e+0],o.y+=m[e+1],i.x=o.x,i.y=o.y,t.lineTo(o.x,o.y),0===e&&!0===c&&l.copy(o);break;case"c":m=a(d);for(let e=0,r=m.length;e<r;e+=6)t.bezierCurveTo(o.x+m[e+0],o.y+m[e+1],o.x+m[e+2],o.y+m[e+3],o.x+m[e+4],o.y+m[e+5]),i.x=o.x+m[e+2],i.y=o.y+m[e+3],o.x+=m[e+4],o.y+=m[e+5],0===e&&!0===c&&l.copy(o);break;case"s":m=a(d);for(let e=0,r=m.length;e<r;e+=4)t.bezierCurveTo(s(o.x,i.x),s(o.y,i.y),o.x+m[e+0],o.y+m[e+1],o.x+m[e+2],o.y+m[e+3]),i.x=o.x+m[e+0],i.y=o.y+m[e+1],o.x+=m[e+2],o.y+=m[e+3],0===e&&!0===c&&l.copy(o);break;case"q":m=a(d);for(let e=0,r=m.length;e<r;e+=4)t.quadraticCurveTo(o.x+m[e+0],o.y+m[e+1],o.x+m[e+2],o.y+m[e+3]),i.x=o.x+m[e+0],i.y=o.y+m[e+1],o.x+=m[e+2],o.y+=m[e+3],0===e&&!0===c&&l.copy(o);break;case"t":m=a(d);for(let e=0,r=m.length;e<r;e+=2){const r=s(o.x,i.x),n=s(o.y,i.y);t.quadraticCurveTo(r,n,o.x+m[e+0],o.y+m[e+1]),i.x=r,i.y=n,o.x=o.x+m[e+0],o.y=o.y+m[e+1],0===e&&!0===c&&l.copy(o)}break;case"a":m=a(d,[3,4],7);for(let e=0,n=m.length;e<n;e+=7){if(0==m[e+5]&&0==m[e+6])continue;const n=o.clone();o.x+=m[e+5],o.y+=m[e+6],i.x=o.x,i.y=o.y,r(t,m[e],m[e+1],m[e+2],m[e+3],m[e+4],n,o),0===e&&!0===c&&l.copy(o)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(o.copy(l),t.currentPath.currentPoint.copy(o),u=!0);break;default:console.warn(e)}c=!1}return t}(t));break;case"rect":o=i(t,o),S=function(e){const t=c(e.getAttribute("x")||0),r=c(e.getAttribute("y")||0),o=c(e.getAttribute("rx")||e.getAttribute("ry")||0),i=c(e.getAttribute("ry")||e.getAttribute("rx")||0),s=c(e.getAttribute("width")),a=c(e.getAttribute("height")),l=.448084975506,u=new n.ShapePath;u.moveTo(t+o,r),u.lineTo(t+s-o,r),(0!==o||0!==i)&&u.bezierCurveTo(t+s-o*l,r,t+s,r+i*l,t+s,r+i);u.lineTo(t+s,r+a-i),(0!==o||0!==i)&&u.bezierCurveTo(t+s,r+a-i*l,t+s-o*l,r+a,t+s-o,r+a);u.lineTo(t+o,r+a),(0!==o||0!==i)&&u.bezierCurveTo(t+o*l,r+a,t,r+a-i*l,t,r+a-i);u.lineTo(t,r+i),(0!==o||0!==i)&&u.bezierCurveTo(t,r+i*l,t+o*l,r,t+o,r);return u}(t);break;case"polygon":o=i(t,o),S=function(e){function t(e,t,r){const n=c(t),s=c(r);0===i?o.moveTo(n,s):o.lineTo(n,s),i++}const r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,o=new n.ShapePath;let i=0;return e.getAttribute("points").replace(r,t),o.currentPath.autoClose=!0,o}(t);break;case"polyline":o=i(t,o),S=function(e){function t(e,t,r){const n=c(t),s=c(r);0===i?o.moveTo(n,s):o.lineTo(n,s),i++}const r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,o=new n.ShapePath;let i=0;return e.getAttribute("points").replace(r,t),o.currentPath.autoClose=!1,o}(t);break;case"circle":o=i(t,o),S=function(e){const t=c(e.getAttribute("cx")||0),r=c(e.getAttribute("cy")||0),o=c(e.getAttribute("r")||0),i=new n.Path;i.absarc(t,r,o,0,2*Math.PI);const s=new n.ShapePath;return s.subPaths.push(i),s}(t);break;case"ellipse":o=i(t,o),S=function(e){const t=c(e.getAttribute("cx")||0),r=c(e.getAttribute("cy")||0),o=c(e.getAttribute("rx")||0),i=c(e.getAttribute("ry")||0),s=new n.Path;s.absellipse(t,r,o,i,0,2*Math.PI);const a=new n.ShapePath;return a.subPaths.push(s),a}(t);break;case"line":o=i(t,o),S=function(e){const t=c(e.getAttribute("x1")||0),r=c(e.getAttribute("y1")||0),o=c(e.getAttribute("x2")||0),i=c(e.getAttribute("y2")||0),s=new n.ShapePath;return s.moveTo(t,r),s.lineTo(o,i),s.currentPath.autoClose=!1,s}(t);break;case"defs":u=!1;break;case"use":o=i(t,o);const l=t.href.baseVal.substring(1),f=t.viewportElement.getElementById(l);f?e(f,o):console.warn("SVGLoader: 'use node' references non-existent node id: "+l)}if(S&&(void 0!==o.fill&&"none"!==o.fill&&S.color.setStyle(o.fill),function(e,t){function r(e){w.set(e.x,e.y,1).applyMatrix3(t),e.set(w.x,w.y)}const n=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),o=e.subPaths;for(let i=0,s=o.length;i<s;i++){const e=o[i].curves;for(let o=0;o<e.length;o++){const i=e[o];i.isLineCurve?(r(i.v1),r(i.v2)):i.isCubicBezierCurve?(r(i.v0),r(i.v1),r(i.v2),r(i.v3)):i.isQuadraticBezierCurve?(r(i.v0),r(i.v1),r(i.v2)):i.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),b.set(i.aX,i.aY),r(b),i.aX=b.x,i.aY=b.y,i.xRadius*=f(t),i.yRadius*=h(t))}}}(S,M),d.push(S),S.userData={node:t,style:o}),u){const r=t.childNodes;for(let t=0;t<r.length;t++)e(r[t],o)}l&&(p.pop(),p.length>0?M.copy(p[p.length-1]):M.identity())}(S.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:d,xml:S.documentElement}}static createShapes(e){const t=999999999,r=0,o=1,i=2,s=3,a=4,l=5,u=6,c={loc:r,t:0};function f(e,t,n,o){const s=e.x,a=t.x,l=n.x,u=o.x,f=e.y,d=t.y,m=n.y,p=o.y,y=(u-l)*(f-m)-(p-m)*(s-l),v=(p-m)*(a-s)-(u-l)*(d-f),x=y/v,g=((a-s)*(f-m)-(d-f)*(s-l))/v;if(0===v&&0!==y||x<=0||x>=1||g<0||g>1)return null;if(0===y&&0===v){for(let l=0;l<2;l++){if(h(0===l?n:o,e,t),c.loc==r){const e=0===l?n:o;return{x:e.x,y:e.y,t:c.t}}if(c.loc==i){return{x:+(s+c.t*(a-s)).toPrecision(10),y:+(f+c.t*(d-f)).toPrecision(10),t:c.t}}}return null}for(let i=0;i<2;i++)if(h(0===i?n:o,e,t),c.loc==r){const e=0===i?n:o;return{x:e.x,y:e.y,t:c.t}}return{x:+(s+x*(a-s)).toPrecision(10),y:+(f+x*(d-f)).toPrecision(10),t:x}}function h(e,t,n){const f=n.x-t.x,h=n.y-t.y,d=e.x-t.x,m=e.y-t.y,p=f*m-d*h;if(e.x===t.x&&e.y===t.y)return c.loc=r,void(c.t=0);if(e.x===n.x&&e.y===n.y)return c.loc=o,void(c.t=1);if(p<-Number.EPSILON)return void(c.loc=s);if(p>Number.EPSILON)return void(c.loc=a);if(f*d<0||h*m<0)return void(c.loc=l);if(Math.sqrt(f*f+h*h)<Math.sqrt(d*d+m*m))return void(c.loc=u);let y;y=0!==f?d/f:m/h,c.loc=i,c.t=y}function d(e,t,r){const o=new n.Vector2;t.getCenter(o);const i=[];return r.forEach((t=>{if(t.boundingBox.containsPoint(o)){(function(e,t){const r=[],o=[];for(let i=1;i<e.length;i++){const s=e[i-1],a=e[i];for(let e=1;e<t.length;e++){const i=f(s,a,t[e-1],t[e]);null!==i&&void 0===r.find((e=>e.t<=i.t+Number.EPSILON&&e.t>=i.t-Number.EPSILON))&&(r.push(i),o.push(new n.Vector2(i.x,i.y)))}}return o})(e,t.points).forEach((e=>{i.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),i.sort(((e,t)=>e.point.x-t.point.x)),i}let m=0,p=t,y=-999999999,v=e.subPaths.map((e=>{const r=e.getPoints();let o=-999999999,i=t,s=-999999999,a=t;for(let t=0;t<r.length;t++){const e=r[t];e.y>o&&(o=e.y),e.y<i&&(i=e.y),e.x>s&&(s=e.x),e.x<a&&(a=e.x)}return y<=s&&(y=s+1),p>=a&&(p=a-1),{curves:e.curves,points:r,isCW:n.ShapeUtils.isClockWise(r),identifier:m++,boundingBox:new n.Box2(new n.Vector2(a,i),new n.Vector2(s,o))}}));v=v.filter((e=>e.points.length>1));const x=v.map((t=>function(e,t,r,o,i){null!==i&&void 0!==i&&""!==i||(i="nonzero");const s=new n.Vector2;e.boundingBox.getCenter(s);const a=d([new n.Vector2(r,s.y),new n.Vector2(o,s.y)],e.boundingBox,t);a.sort(((e,t)=>e.point.x-t.point.x));const l=[],u=[];a.forEach((t=>{t.identifier===e.identifier?l.push(t):u.push(t)}));const c=l[0].point.x,f=[];let h=0;for(;h<u.length&&u[h].point.x<c;)f.length>0&&f[f.length-1]===u[h].identifier?f.pop():f.push(u[h].identifier),h++;if(f.push(e.identifier),"evenodd"===i){const t=f.length%2===0,r=f[f.length-2];return{identifier:e.identifier,isHole:t,for:r}}if("nonzero"===i){let r=!0,n=null,o=null;for(let e=0;e<f.length;e++){const i=f[e];r?(o=t[i].isCW,r=!1,n=i):o!==t[i].isCW&&(o=t[i].isCW,r=!0)}return{identifier:e.identifier,isHole:r,for:n}}console.warn('fill-rule: "'+i+'" is currently not implemented.')}(t,v,p,y,e.userData.style.fillRule))),g=[];return v.forEach((e=>{if(!x[e.identifier].isHole){const t=new n.Shape;t.curves=e.curves;x.filter((t=>t.isHole&&t.for===e.identifier)).forEach((e=>{const r=v[e.identifier],o=new n.Path;o.curves=r.curves,t.holes.push(o)})),g.push(t)}})),g}static getStrokeStyle(e,t,r,n,o){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:o=void 0!==o?o:4}}static pointsToStroke(e,t,r,i){const s=[],a=[],l=[];if(0===o.pointsToStrokeWithBuffers(e,t,r,i,s,a,l))return null;const u=new n.BufferGeometry;return u.setAttribute("position",new n.Float32BufferAttribute(s,3)),u.setAttribute("normal",new n.Float32BufferAttribute(a,3)),u.setAttribute("uv",new n.Float32BufferAttribute(l,2)),u}static pointsToStrokeWithBuffers(e,t,r,o,i,s,a,l){const u=new n.Vector2,c=new n.Vector2,f=new n.Vector2,h=new n.Vector2,d=new n.Vector2,m=new n.Vector2,p=new n.Vector2,y=new n.Vector2,v=new n.Vector2,x=new n.Vector2,g=new n.Vector2,b=new n.Vector2,w=new n.Vector2,M=new n.Vector2,S=new n.Vector2,T=new n.Vector2,B=new n.Vector2;r=void 0!==r?r:12,o=void 0!==o?o:.001,l=void 0!==l?l:0;const A=(e=function(e){let t=!1;for(let n=1,i=e.length-1;n<i;n++)if(e[n].distanceTo(e[n+1])<o){t=!0;break}if(!t)return e;const r=[];r.push(e[0]);for(let n=1,i=e.length-1;n<i;n++)e[n].distanceTo(e[n+1])>=o&&r.push(e[n]);return r.push(e[e.length-1]),r}(e)).length;if(A<2)return 0;const D=e[0].equals(e[A-1]);let _,E,C=e[0];const R=t.strokeWidth/2,k=1/(A-1);let P,U,V,L,F=0,I=!1,O=0,z=3*l,j=2*l;N(e[0],e[1],u).multiplyScalar(R),y.copy(e[0]).sub(u),v.copy(e[0]).add(u),x.copy(y),g.copy(v);for(let n=1;n<A;n++){_=e[n],E=n===A-1?D?e[1]:void 0:e[n+1];const r=u;if(N(C,_,r),f.copy(r).multiplyScalar(R),b.copy(_).sub(f),w.copy(_).add(f),P=F+k,U=!1,void 0!==E){N(_,E,c),f.copy(c).multiplyScalar(R),M.copy(_).sub(f),S.copy(_).add(f),V=!0,f.subVectors(E,C),r.dot(f)<0&&(V=!1),1===n&&(I=V),f.subVectors(E,_),f.normalize();const e=Math.abs(r.dot(f));if(0!==e){const r=R/e;f.multiplyScalar(-r),h.subVectors(_,C),d.copy(h).setLength(r).add(f),T.copy(d).negate();const n=d.length(),o=h.length();h.divideScalar(o),m.subVectors(E,_);const i=m.length();switch(m.divideScalar(i),h.dot(T)<o&&m.dot(T)<i&&(U=!0),B.copy(d).add(_),T.add(_),L=!1,U?V?(S.copy(T),w.copy(T)):(M.copy(T),b.copy(T)):q(),t.strokeLineJoin){case"bevel":H(V,U,P);break;case"round":Y(V,U),V?W(_,b,M,P,0):W(_,S,w,P,1);break;case"miter":case"miter-clip":default:const e=R*t.strokeMiterLimit/n;if(e<1){if("miter-clip"!==t.strokeLineJoin){H(V,U,P);break}Y(V,U),V?(m.subVectors(B,b).multiplyScalar(e).add(b),p.subVectors(B,M).multiplyScalar(e).add(M),G(b,P,0),G(m,P,0),G(_,P,.5),G(_,P,.5),G(m,P,0),G(p,P,0),G(_,P,.5),G(p,P,0),G(M,P,0)):(m.subVectors(B,w).multiplyScalar(e).add(w),p.subVectors(B,S).multiplyScalar(e).add(S),G(w,P,1),G(m,P,1),G(_,P,.5),G(_,P,.5),G(m,P,1),G(p,P,1),G(_,P,.5),G(p,P,1),G(S,P,1))}else U?(V?(G(v,F,1),G(y,F,0),G(B,P,0),G(v,F,1),G(B,P,0),G(T,P,1)):(G(v,F,1),G(y,F,0),G(B,P,1),G(y,F,0),G(T,P,0),G(B,P,1)),V?M.copy(B):S.copy(B)):V?(G(b,P,0),G(B,P,0),G(_,P,.5),G(_,P,.5),G(B,P,0),G(M,P,0)):(G(w,P,1),G(B,P,1),G(_,P,.5),G(_,P,.5),G(B,P,1),G(S,P,1)),L=!0}}else q()}else q();D||n!==A-1||Q(e[0],x,g,V,!0,F),F=P,C=_,y.copy(M),v.copy(S)}if(D){if(U&&i){let e=B,t=T;I!==V&&(e=T,t=B),V?(L||I)&&(t.toArray(i,0),t.toArray(i,9),L&&e.toArray(i,3)):!L&&I||(t.toArray(i,3),t.toArray(i,9),L&&e.toArray(i,0))}}else Q(_,b,w,V,!1,P);return O;function N(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function G(e,t,r){i&&(i[z]=e.x,i[z+1]=e.y,i[z+2]=0,s&&(s[z]=0,s[z+1]=0,s[z+2]=1),z+=3,a&&(a[j]=t,a[j+1]=r,j+=2)),O+=3}function W(e,t,n,o,i){u.copy(t).sub(e).normalize(),c.copy(n).sub(e).normalize();let s=Math.PI;const a=u.dot(c);Math.abs(a)<1&&(s=Math.abs(Math.acos(a))),s/=r,f.copy(t);for(let l=0,u=r-1;l<u;l++)h.copy(f).rotateAround(e,s),G(f,o,i),G(h,o,i),G(e,o,.5),f.copy(h);G(h,o,i),G(n,o,i),G(e,o,.5)}function q(){G(v,F,1),G(y,F,0),G(b,P,0),G(v,F,1),G(b,P,1),G(w,P,0)}function H(e,t,r){t?e?(G(v,F,1),G(y,F,0),G(b,P,0),G(v,F,1),G(b,P,0),G(T,P,1),G(b,r,0),G(M,r,0),G(T,r,.5)):(G(v,F,1),G(y,F,0),G(w,P,1),G(y,F,0),G(T,P,0),G(w,P,1),G(w,r,1),G(S,r,0),G(T,r,.5)):e?(G(b,r,0),G(M,r,0),G(_,r,.5)):(G(w,r,1),G(S,r,0),G(_,r,.5))}function Y(e,t){t&&(e?(G(v,F,1),G(y,F,0),G(b,P,0),G(v,F,1),G(b,P,0),G(T,P,1),G(b,F,0),G(_,P,.5),G(T,P,1),G(_,P,.5),G(M,F,0),G(T,P,1)):(G(v,F,1),G(y,F,0),G(w,P,1),G(y,F,0),G(T,P,0),G(w,P,1),G(w,F,1),G(T,P,0),G(_,P,.5),G(_,P,.5),G(T,P,0),G(S,F,1)))}function Q(e,r,n,o,s,a){switch(t.strokeLineCap){case"round":s?W(e,n,r,a,.5):W(e,r,n,a,.5);break;case"square":if(s)u.subVectors(r,e),c.set(u.y,-u.x),f.addVectors(u,c).add(e),h.subVectors(c,u).add(e),o?(f.toArray(i,3),h.toArray(i,0),h.toArray(i,9)):(f.toArray(i,3),f.toArray(i,9),h.toArray(i,0));else{u.subVectors(n,e),c.set(u.y,-u.x),f.addVectors(u,c).add(e),h.subVectors(c,u).add(e);const t=i.length;o?(f.toArray(i,t-3),h.toArray(i,t-6),h.toArray(i,t-12)):(f.toArray(i,t-6),h.toArray(i,t-3),h.toArray(i,t-12))}}}}}}}]);